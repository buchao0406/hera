(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e62fc8a"],{"07cd":function(t,e,i){},"0abb":function(t,e,i){},"0ac5":function(t,e,i){},"0f7e":function(t,e,i){},"13b3":function(t,e,i){},1449:function(t,e,i){"use strict";i("a9ca")},1695:function(t,e,i){},"1a76":function(t,e,i){"use strict";i("d1a3")},"1c8e":function(t,e,i){"use strict";i("87b6")},"209e":function(t,e,i){},"219b":function(t,e,i){"use strict";i("6db4")},"24ec":function(t,e,i){},"251e":function(t,e,i){"use strict";i("f4b6")},"26ba":function(t,e,i){},2946:function(t,e,i){},"2a59":function(t,e,i){"use strict";i("5ee0")},3422:function(t,e,i){"use strict";i("0abb")},3658:function(t,e,i){},3744:function(t,e,i){},"39ee":function(t,e,i){"use strict";i("7b60")},"407c":function(t,e,i){"use strict";i("0f7e")},4140:function(t,e,i){"use strict";i("3658")},4327:function(t,e,i){},"43d7":function(t,e,i){},"4cf5":function(t,e,i){"use strict";i("7307")},"4f44":function(t,e,i){"use strict";i("ee21")},"52c1":function(t,e,i){"use strict";i("2946")},"593a":function(t,e,i){"use strict";i("13b3")},"5d3c":function(t,e,i){"use strict";i("f04a")},"5db7":function(t,e,i){"use strict";var n=i("23e7"),s=i("a2bf"),o=i("7b0b"),a=i("50c4"),r=i("1c0b"),c=i("65f0");n({target:"Array",proto:!0},{flatMap:function(t){var e,i=o(this),n=a(i.length);return r(t),e=c(i,0),e.length=s(e,i,i,n,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},"5ee0":function(t,e,i){},6062:function(t,e,i){"use strict";var n=i("6d61"),s=i("6566");t.exports=n("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},6566:function(t,e,i){"use strict";var n=i("9bf2").f,s=i("7c73"),o=i("e2cc"),a=i("0366"),r=i("19aa"),c=i("2266"),l=i("7dd0"),u=i("2626"),d=i("83ab"),f=i("f183").fastKey,h=i("69f3"),p=h.set,m=h.getterFor;t.exports={getConstructor:function(t,e,i,l){var u=t((function(t,n){r(t,u,e),p(t,{type:e,index:s(null),first:void 0,last:void 0,size:0}),d||(t.size=0),void 0!=n&&c(n,t[l],{that:t,AS_ENTRIES:i})})),h=m(e),v=function(t,e,i){var n,s,o=h(t),a=b(t,e);return a?a.value=i:(o.last=a={index:s=f(e,!0),key:e,value:i,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),d?o.size++:t.size++,"F"!==s&&(o.index[s]=a)),t},b=function(t,e){var i,n=h(t),s=f(e);if("F"!==s)return n.index[s];for(i=n.first;i;i=i.next)if(i.key==e)return i};return o(u.prototype,{clear:function(){var t=this,e=h(t),i=e.index,n=e.first;while(n)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete i[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:t.size=0},delete:function(t){var e=this,i=h(e),n=b(e,t);if(n){var s=n.next,o=n.previous;delete i.index[n.index],n.removed=!0,o&&(o.next=s),s&&(s.previous=o),i.first==n&&(i.first=s),i.last==n&&(i.last=o),d?i.size--:e.size--}return!!n},forEach:function(t){var e,i=h(this),n=a(t,arguments.length>1?arguments[1]:void 0,3);while(e=e?e.next:i.first){n(e.value,e.key,this);while(e&&e.removed)e=e.previous}},has:function(t){return!!b(this,t)}}),o(u.prototype,i?{get:function(t){var e=b(this,t);return e&&e.value},set:function(t,e){return v(this,0===t?0:t,e)}}:{add:function(t){return v(this,t=0===t?0:t,t)}}),d&&n(u.prototype,"size",{get:function(){return h(this).size}}),u},setStrong:function(t,e,i){var n=e+" Iterator",s=m(e),o=m(n);l(t,e,(function(t,e){p(this,{type:n,target:t,state:s(t),kind:e,last:void 0})}),(function(){var t=o(this),e=t.kind,i=t.last;while(i&&i.removed)i=i.previous;return t.target&&(t.last=i=i?i.next:t.state.first)?"keys"==e?{value:i.key,done:!1}:"values"==e?{value:i.value,done:!1}:{value:[i.key,i.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),i?"entries":"values",!i,!0),u(e)}}},"683c":function(t,e,i){},"687e":function(t,e,i){},"6d61":function(t,e,i){"use strict";var n=i("23e7"),s=i("da84"),o=i("94ca"),a=i("6eeb"),r=i("f183"),c=i("2266"),l=i("19aa"),u=i("861d"),d=i("d039"),f=i("1c7e"),h=i("d44e"),p=i("7156");t.exports=function(t,e,i){var m=-1!==t.indexOf("Map"),v=-1!==t.indexOf("Weak"),b=m?"set":"add",g=s[t],y=g&&g.prototype,_=g,C={},x=function(t){var e=y[t];a(y,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!u(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:function(t,i){return e.call(this,0===t?0:t,i),this})},k=o(t,"function"!=typeof g||!(v||y.forEach&&!d((function(){(new g).entries().next()}))));if(k)_=i.getConstructor(e,t,m,b),r.REQUIRED=!0;else if(o(t,!0)){var w=new _,j=w[b](v?{}:-0,1)!=w,T=d((function(){w.has(1)})),I=f((function(t){new g(t)})),S=!v&&d((function(){var t=new g,e=5;while(e--)t[b](e,e);return!t.has(-0)}));I||(_=e((function(e,i){l(e,_,t);var n=p(new g,e,_);return void 0!=i&&c(i,n[b],{that:n,AS_ENTRIES:m}),n})),_.prototype=y,y.constructor=_),(T||S)&&(x("delete"),x("has"),m&&x("get")),(S||j)&&x(b),v&&y.clear&&delete y.clear}return C[t]=_,n({global:!0,forced:_!=g},C),h(_,t),v||i.setStrong(_,t,m),_}},"6db4":function(t,e,i){},"6e1f":function(t,e,i){"use strict";i("f4a9")},"6f4f4":function(t,e,i){"use strict";i("cb88")},"6fa9":function(t,e,i){"use strict";i("f4f3")},"719e":function(t,e,i){"use strict";i("830b")},7307:function(t,e,i){},"73d9":function(t,e,i){var n=i("44d2");n("flatMap")},"753a":function(t,e,i){"use strict";i("24ec")},"783b":function(t,e,i){"use strict";i("9093")},"7b60":function(t,e,i){},"830b":function(t,e,i){},"85f7":function(t,e,i){},8717:function(t,e,i){"use strict";i("e617")},"87b6":function(t,e,i){},"89cc":function(t,e,i){"use strict";i("f613")},"8d473":function(t,e,i){"use strict";i("0ac5")},"8e11":function(t,e,i){"use strict";i("1695")},9093:function(t,e,i){},"93bf":function(t,e,i){
/*!
* screenfull
* v5.1.0 - 2020-12-24
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var e="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},i=t.exports,n=function(){for(var t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,s=i.length,o={};n<s;n++)if(t=i[n],t&&t[1]in e){for(n=0;n<t.length;n++)o[i[0][n]]=t[n];return o}return!1}(),s={change:n.fullscreenchange,error:n.fullscreenerror},o={request:function(t,i){return new Promise(function(s,o){var a=function(){this.off("change",a),s()}.bind(this);this.on("change",a),t=t||e.documentElement;var r=t[n.requestFullscreen](i);r instanceof Promise&&r.then(a).catch(o)}.bind(this))},exit:function(){return new Promise(function(t,i){if(this.isFullscreen){var s=function(){this.off("change",s),t()}.bind(this);this.on("change",s);var o=e[n.exitFullscreen]();o instanceof Promise&&o.then(s).catch(i)}else t()}.bind(this))},toggle:function(t,e){return this.isFullscreen?this.exit():this.request(t,e)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,i){var n=s[t];n&&e.addEventListener(n,i,!1)},off:function(t,i){var n=s[t];n&&e.removeEventListener(n,i,!1)},raw:n};n?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[n.fullscreenEnabled])}}}),i?t.exports=o:window.screenfull=o):i?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()},9760:function(t,e,i){},a2bf:function(t,e,i){"use strict";var n=i("e8b5"),s=i("50c4"),o=i("0366"),a=function(t,e,i,r,c,l,u,d){var f,h=c,p=0,m=!!u&&o(u,d,3);while(p<r){if(p in i){if(f=m?m(i[p],p,e):i[p],l>0&&n(f))h=a(t,e,f,s(f.length),h,l-1)-1;else{if(h>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[h]=f}h++}p++}return h};t.exports=a},a9ca:function(t,e,i){},aecb:function(t,e,i){},af5f:function(t,e,i){"use strict";i("683c")},b86b:function(t,e,i){"use strict";i("9760")},ba51:function(t,e,i){(function(e,i){t.exports=i()})(0,(function(){"use strict";var t=function(){for(var t=3,e=document.createElement("b"),i=e.all||[];e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i><![endif]--\x3e",i[0];);return t>4?t:document.documentMode}(),e=navigator.platform.toLowerCase().indexOf("mac")+1,i=function(t){if(!(this instanceof i))return new i(t);var a=this,r={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};a.options={};for(var c,l=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],u=0;c=l[u];u++)a.options[c]="undefined"!=typeof t[c]&&null!=t[c]?t[c]:r[c];var d,f=["scroll","content"];for(u=0;d=f[u];u++)if(a[d+"_elem"]=t[d+"Id"]?document.getElementById(t[d+"Id"]):t[d+"Elem"],!a[d+"_elem"])throw new Error("Error! Could not find "+d+" element");a.content_elem.hasAttribute("tabindex")||a.content_elem.setAttribute("tabindex",0);var h=o(t.rows)?t.rows:a.fetchMarkup(),p={},m=a.scroll_elem.scrollTop;a.insertToDOM(h,p),a.scroll_elem.scrollTop=m;var v=!1,b=0,g=!1,y=function(){e&&(g||(a.content_elem.style.pointerEvents="none"),g=!0,clearTimeout(b),b=setTimeout((function(){a.content_elem.style.pointerEvents="auto",g=!1}),50)),v!=(v=a.getClusterNum())&&a.insertToDOM(h,p),a.options.callbacks.scrollingProgress&&a.options.callbacks.scrollingProgress(a.getScrollProgress())},_=0,C=function(){clearTimeout(_),_=setTimeout(a.refresh,100)};n("scroll",a.scroll_elem,y),n("resize",window,C),a.destroy=function(t){s("scroll",a.scroll_elem,y),s("resize",window,C),a.html((t?a.generateEmptyRow():h).join(""))},a.refresh=function(t){(a.getRowsHeight(h)||t)&&a.update(h)},a.update=function(t){h=o(t)?t:[];var e=a.scroll_elem.scrollTop;h.length*a.options.item_height<e&&(a.scroll_elem.scrollTop=0,v=0),a.insertToDOM(h,p),a.scroll_elem.scrollTop=e},a.clear=function(){a.update([])},a.getRowsAmount=function(){return h.length},a.getScrollProgress=function(){return this.options.scroll_top/(h.length*this.options.item_height)*100||0};var x=function(t,e){var i=o(e)?e:[];i.length&&(h="append"==t?h.concat(i):i.concat(h),a.insertToDOM(h,p))};a.append=function(t){x("append",t)},a.prepend=function(t){x("prepend",t)}};function n(t,e,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function s(t,e,i){return e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent("on"+t,i)}function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function a(t,e){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}return i.prototype={constructor:i,fetchMarkup:function(){var t=[],e=this.getChildNodes(this.content_elem);while(e.length)t.push(e.shift().outerHTML);return t},exploreEnvironment:function(e,i){var n=this.options;n.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(t&&t<=9&&!n.tag&&(n.tag=e[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(i.data=this.html(e[0]+e[0]+e[0])),n.tag||(n.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))},getRowsHeight:function(t){var e=this.options,i=e.item_height;if(e.cluster_height=0,t.length){var n=this.content_elem.children;if(n.length){var s=n[Math.floor(n.length/2)];if(e.item_height=s.offsetHeight,"tr"==e.tag&&"collapse"!=a("borderCollapse",this.content_elem)&&(e.item_height+=parseInt(a("borderSpacing",this.content_elem),10)||0),"tr"!=e.tag){var o=parseInt(a("marginTop",s),10)||0,r=parseInt(a("marginBottom",s),10)||0;e.item_height+=Math.max(o,r)}return e.block_height=e.item_height*e.rows_in_block,e.rows_in_cluster=e.blocks_in_cluster*e.rows_in_block,e.cluster_height=e.blocks_in_cluster*e.block_height,i!=e.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var t=this.options;if(!t.tag||!t.show_no_data_row)return[];var e,i=document.createElement(t.tag),n=document.createTextNode(t.no_data_text);return i.className=t.no_data_class,"tr"==t.tag&&(e=document.createElement("td"),e.colSpan=100,e.appendChild(n)),i.appendChild(e||n),[i.outerHTML]},generate:function(t,e){var i=this.options,n=t.length;if(n<i.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:n?t:this.generateEmptyRow()};var s=Math.max((i.rows_in_cluster-i.rows_in_block)*e,0),o=s+i.rows_in_cluster,a=Math.max(s*i.item_height,0),r=Math.max((n-o)*i.item_height,0),c=[],l=s;a<1&&l++;for(var u=s;u<o;u++)t[u]&&c.push(t[u]);return{top_offset:a,bottom_offset:r,rows_above:l,rows:c}},renderExtraTag:function(t,e){var i=document.createElement(this.options.tag),n="clusterize-";return i.className=[n+"extra-row",n+t].join(" "),e&&(i.style.height=e+"px"),i.outerHTML},insertToDOM:function(t,e){this.options.cluster_height||this.exploreEnvironment(t,e);var i=this.generate(t,this.getClusterNum()),n=i.rows.join(""),s=this.checkChanges("data",n,e),o=this.checkChanges("top",i.top_offset,e),a=this.checkChanges("bottom",i.bottom_offset,e),r=this.options.callbacks,c=[];s||o?(i.top_offset&&(this.options.keep_parity&&c.push(this.renderExtraTag("keep-parity")),c.push(this.renderExtraTag("top-space",i.top_offset))),c.push(n),i.bottom_offset&&c.push(this.renderExtraTag("bottom-space",i.bottom_offset)),r.clusterWillChange&&r.clusterWillChange(),this.html(c.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",i.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(i.rows_above-1),r.clusterChanged&&r.clusterChanged()):a&&(this.content_elem.lastChild.style.height=i.bottom_offset+"px")},html:function(e){var i=this.content_elem;if(t&&t<=9&&"tr"==this.options.tag){var n,s=document.createElement("div");s.innerHTML="<table><tbody>"+e+"</tbody></table>";while(n=i.lastChild)i.removeChild(n);var o=this.getChildNodes(s.firstChild.firstChild);while(o.length)i.appendChild(o.shift())}else i.innerHTML=e},getChildNodes:function(t){for(var e=t.children,i=[],n=0,s=e.length;n<s;n++)i.push(e[n]);return i},checkChanges:function(t,e,i){var n=e!=i[t];return i[t]=e,n}},i}))},bb2f:function(t,e,i){var n=i("d039");t.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},be69:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"develop-container"},[i("a-layout",[i("a-layout-header",{staticClass:"header"},[i("main-header")],1),i("a-layout-content",{class:{content:!0,fullscreen:t.fullscreen}},[i("main-center",{scopedSlots:t._u([{key:"left-side",fn:function(){return[i("tabs",{attrs:{tabs:t.tabs.left,active:t.leftTab.name},on:{change:function(e){return t.changeTab(e.name,"left")}}})]},proxy:!0},{key:"right-side",fn:function(){return[i("tabs",{attrs:{tabs:t.tabs.right,active:t.rightTab.name},on:{change:function(e){return t.changeTab(e.name,"right")}}})]},proxy:!0},{key:"left",fn:function(){return[i("content-left",{staticClass:"content-in"})]},proxy:!0},{key:"center",fn:function(){return[i("content-center",{staticClass:"content-in"})]},proxy:!0},{key:"right",fn:function(){return[i("right-attached",{staticClass:"content-in"})]},proxy:!0},{key:"bottom",fn:function(){return[i("footer-attached",{staticClass:"content-in"})]},proxy:!0}])})],1),i("a-layout-footer",{staticClass:"footer"},[i("main-footer")],1)],1),t.loading?i("div",{staticClass:"mask"},[i("div",{staticStyle:{"padding-top":"30vh","font-size":"14px"}},[t._v(" 初始化数据中，请稍等…… ")])]):t._e()],1)},s=[],o=(i("a9e3"),i("5530")),a=(i("7db0"),i("2f62")),r={computed:Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(a["e"])("setting",["theme","fullscreen"])),Object(a["e"])("develop",["jobTrees","treeCaches","layoutConfig","jobList"])),Object(a["c"])("develop",["tabs","tabActive","selectedTabNode","selectedTabNodes","selectedKey","selectedTabKeys","selectedTabNodeCrumbs","isSelectedGroup","editorBottomTabs","logRecord","jobOpRecord","depSetting"])),{},{onlyCenter:function(){return this.layoutConfig.onlyCenter},tab_:function(){return function(t){return!this.onlyCenter&&this.tabActive(t)||{}}},leftTab:function(){return this.tab_("left")},rightTab:function(){return this.tab_("right")},bottomTab:function(){return this.tab_("bottom")},job:function(){var t=this;return this.jobList.find((function(e){var i,n;return e.id===(null===(i=t.selectedTabNode)||void 0===i||null===(n=i.origin)||void 0===n?void 0:n.id)}))},group:function(){return this.selectedTabNode.origin}}),methods:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(a["d"])("develop",["toggleOnlyCenter","setEditorBottom","setLogContainerWidth"])),Object(a["b"])("develop",["restoreLayout","restoreLocal","initJobs","resizeTab","setTab","setExpanedTreeNodes","selectTreeNode","switchSelectedTab","closeTab","closeAllTabs","closeAllRightTabs","closeOtherTabs","createGroup","createJob","copyJob","getLogContent","setJobScriptEdited","cancelJob","previewJobScript"])),{},{changeTab:function(t,e){this.setTab({name:t,type:e})},changeTabSize:function(t,e){this.resizeTab({width:t,type:e})},getTab:function(t){return this.tab[t]}})},c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:["container",t.mode]},t._l(t.tabs,(function(e){return i("div",{key:e.name,class:{tab:!0,active:t.active===e.name},on:{click:function(i){return t.change(e)}}},[i("div",{staticClass:"label"},[i("my-icon",{staticClass:"icon",attrs:{type:"hera_icon_"+e.icon}}),t._v(" "+t._s(e.label)+" ")],1)])})),0)},l=[],u={props:{active:{required:!0,type:String,default:""},tabs:{type:Array,requried:!0},mode:{type:String,default:"vertical"}},methods:{change:function(t){this.$emit("change",t)}}},d=u,f=(i("e2b9"),i("2877")),h=Object(f["a"])(d,c,l,!1,null,"2909cf74",null),p=h.exports,m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"operation-bar header-icons"},[t._l(t.buttons,(function(e,n){return[i("a-tooltip",{key:n,attrs:{mouseEnterDelay:.6}},[i("template",{slot:"title"},[t._v(t._s(t.buttonTip(e)))]),i("my-icon",{class:["icon",t.buttonIcon(e),!t.job&&e.disabled?"disabled":""],attrs:{type:"hera_icon_"+t.buttonIcon(e)},on:{click:function(i){return t.buttonClick(e)}}})],2),e.divider?i("a-divider",{key:"d_"+n,attrs:{type:"vertical"}}):t._e()]})),i("my-icon",{staticClass:"icon",attrs:{type:"hera_icon_fullscreen"+(t.fullscreen?"-exit":"")},on:{click:t.full}}),i("my-icon",{class:["icon",[t.theme.mode]],attrs:{type:"hera_icon_"+{light:"moon",night:"sun"}[t.theme.mode]},on:{click:function(e){return t.$store.commit("setting/setTheme",Object.assign({},t.theme,{mode:{light:"night",night:"light"}[t.theme.mode]}))}}})],2),i("div",{staticClass:"crumbs"},t._l(t.selectedTabNodeCrumbs,(function(e,n){return i("span",{key:n,staticClass:"crumbs-item"},[t._v(t._s(e.title)+" "),n<t.selectedTabNodeCrumbs.length-1?i("a-icon",{attrs:{type:"right"}}):t._e()],1)})),0),i("run-option-dialog",{ref:"runOptionRef"}),i("publish-option-dialog",{ref:"publishOptionRef",attrs:{first:t.noPublishes}}),i("upload-option-dialog",{ref:"uploadOptionRef"}),i("job-search-dialog",{ref:"jobSerachRef"}),i("setting",{ref:"settingRef"}),i("code-compare",{ref:"codeCompareRef"},[i("div",{staticStyle:{"line-height":"50px"}},[i("a",{directives:[{name:"show",rawName:"v-show",value:t.showButton,expression:"showButton"}],staticStyle:{"margin-right":"10px","font-size":"13px"},attrs:{size:"small"},on:{click:function(){t.save(t.job.id).then((function(){t.$refs.codeCompareRef.close()}))}}},[t._v("确定修改")])])]),i("job-dependency-dialog",{ref:"jobDependencyDialogRef"})],1)},v=[],b=(i("4de4"),i("caad"),i("2532"),i("498a"),i("5319"),i("ac1f"),i("1215")),g=i("93bf"),y=i.n(g),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"run-option-dialog",visible:t.visible,width:"240px",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"title"},[t._v("运行任务")]),i("h-select",{attrs:{options:t.versions},model:{value:t.option.actionId,callback:function(e){t.$set(t.option,"actionId",e)},expression:"option.actionId"}}),i("div",{staticClass:"type-select"},t._l(t.triggerTypes,(function(e){return i("div",{key:e.value,class:["type",e.value===t.option.triggerType?"active":""],on:{click:function(i){t.option.triggerType=e.value}}},[i("span",[t._v(t._s(e.label))])])})),0),i("div",{staticClass:"button",on:{click:t.submit}},[t._v("确定")])],1)},C=[],x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"select-container",attrs:{id:"test"}},[i("div",{class:["select-show",t.disabled?"disabled":""],on:{click:t.showOptions}},[t.valueIsArray&&t.multiple?i("div",{staticClass:"option-list"},[t._l(t.selectedOptions,(function(e,n){return i("div",{key:n,staticClass:"option"},[t._v(" "+t._s(e.label)+" "),i("a-icon",{staticStyle:{"font-size":"10px"},attrs:{type:"close"},on:{click:function(i){return i.stopPropagation(),t.chooseOption(e)}}})],1)})),t.filterable?i("input",{directives:[{name:"model",rawName:"v-model",value:t.filterValue,expression:"filterValue"}],staticClass:"input",attrs:{size:"small",placeholder:t.placeholder||""},domProps:{value:t.filterValue},on:{click:t.resetFilterValue,input:[function(e){e.target.composing||(t.filterValue=e.target.value)},function(e){t.optionVisible=!0}]}}):t._e()],2):i("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[i("div",{staticClass:"option",staticStyle:{"margin-left":"4px",display:"flex"}},[t.filterable?i("input",{directives:[{name:"model",rawName:"v-model",value:t.filterValue,expression:"filterValue"}],staticClass:"input",attrs:{placeholder:(t.selectedOptions.length>0?t.selectedOptions[0].label:"")||t.placeholder,size:"small"},domProps:{value:t.filterValue},on:{click:t.resetFilterValue,input:[function(e){e.target.composing||(t.filterValue=e.target.value)},function(e){t.optionVisible=!0}]}}):[t.selectedOptions.length>0?i("div",[t._v(" "+t._s(t.selectedOptions[0].label)+" ")]):t._e()]],2),i("a-icon",{staticClass:"caret",attrs:{type:"caret-"+(t.optionVisible?"up":"down")}})],1)]),i("div",{staticStyle:{position:"relative"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.optionVisible,expression:"optionVisible"}],class:["select-options"]},[t.filterOptions.length>0?t._l(t.filterOptions,(function(e,n){return i("div",{key:n,class:["option",t.isActive(e)?"active":""],on:{click:function(i){return t.chooseOption(e)}}},[i("div",{staticClass:"label"},[i("div",[t._v(t._s(e.label))]),t.isActive(e)&&t.multiple&&t.valueIsArray?i("div",[i("a-icon",{attrs:{type:"check"}})],1):t._e()])])})):i("div",{staticStyle:{"text-align":"center","font-size":"12px",padding:"4px 0"}},[t._v(" 暂无数据 ")])],2)])])},k=[],w=i("2909"),j=i("53ca"),T=(i("d81d"),i("d3b7"),i("25f0"),i("c740"),i("a434"),{data:function(){return{optionVisible:!1,filterValue:""}},model:{prop:"value",event:"change"},props:{value:[Boolean,Number,String,Array],options:Array,multiple:{require:!1,type:Boolean},filterable:{require:!1,type:Boolean,default:!1},placeholder:{type:String,require:!1},disabled:{type:Boolean,require:!1,default:!1}},computed:{selectedOptions:function(){var t=this,e=this.valueIsArray?this.value:[this.value];return e.map((function(e){return t.realOptions.find((function(t){return t.value===e}))||{value:e,label:e}}))},valueIsArray:function(){return Array.isArray(this.value)},realOptions:function(){return this.options.map((function(t){return"object"===Object(j["a"])(t)?t:{value:t,label:t}}))},filterOptions:function(){var t=this.filterValue;return 0===t.trim().length?this.realOptions:this.realOptions.filter((function(e){return e.label.includes(t)||e.value.toString().includes(t)}))}},created:function(){window.addEventListener("click",this.clickOther)},destroyed:function(){window.removeEventListener("click",this.clickOther)},methods:{resetFilterValue:function(){this.selectedOptions.length>0&&this.filterValue&&(this.filterValue="")},isActive:function(t){var e=this.value;return this.valueIsArray?e.includes(t.value):e===t.value},showOptions:function(){this.disabled||(this.optionVisible=!this.optionVisible)},chooseOption:function(t){var e=t.value;if(this.multiple){var i=Object(w["a"])(this.value),n=i.findIndex((function(e){return e===t.value}));-1===n?i.push(t.value):i.splice(n,1),e=i}this.$emit("change",e),this.multiple||(this.optionVisible=!1),this.filterValue=""},clickOther:function(t){var e=this.$el.querySelector(".select-options"),i=this.$el.querySelector(".select-show");i&&(i===t.target||i.contains(t.target))||e&&!e.contains(t.target)&&this.optionVisible&&(this.optionVisible=!1)}}}),I=T,S=(i("eb58"),Object(f["a"])(I,x,k,!1,null,null,null)),O=S.exports,$=[{value:2,label:"手动执行"},{value:3,label:"手动恢复"},{value:6,label:"超级恢复"}],E={data:function(){return{triggerTypes:$,versions:[],option:{actionId:"",triggerType:2},visible:!1,callback:null}},components:{HSelect:O},methods:{close:function(){this.visible=!1,this.callback=null,this.option={actionId:"",triggerType:2}},show:function(t,e){this.versions=t,this.option.actionId=t[0],this.visible=!0,this.callback=e},submit:function(){this.callback(this.option),this.visible=!1}}},N=E,R=(i("c56d"),Object(f["a"])(N,_,C,!1,null,null,null)),L=R.exports,z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"option-dialog",visible:t.visible,width:"240px",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"title"},[t._v("发布任务")]),i("a-textarea",{staticStyle:{"border-bottom":"none"},attrs:{placeholder:"此次发布描述，修改的内容",size:"small"},model:{value:t.option.description,callback:function(e){t.$set(t.option,"description",e)},expression:"option.description"}}),i("h-select",{attrs:{filterable:!0,options:t.users.map((function(t){return{label:t.name,value:t.id}})),placeholder:"审核人"},model:{value:t.option.auditor,callback:function(e){t.$set(t.option,"auditor",e)},expression:"option.auditor"}}),t.first?i("div",{staticStyle:{display:"flex","align-items":"center",position:"relative",margin:"-1px 0"}},[i("a-tree-select",{staticStyle:{width:"calc(100% - 30px)","font-size":"12px"},attrs:{placeholder:"第一次发布选择文件夹",getPopupContainer:function(e){return e.parentNode||t.document.body},"dropdown-style":{maxHeight:"400px",overflow:"auto","font-size":"12px"},size:"small","tree-data":"my"===t.showType?t.myOnlineGroups:t.onlineGroups},model:{value:t.option.groupId,callback:function(e){t.$set(t.option,"groupId",e)},expression:"option.groupId"}}),i("div",{staticStyle:{width:"30px","margin-left":"4px",cursor:"pointer","text-align":"center"},on:{click:function(e){t.showType="my"===t.showType?"all":"my"}}},[t._v(" "+t._s("my"===t.showType?"我的":"全部")+" ")])],1):t._e(),i("div",{staticClass:"button",on:{click:t.submit}},[t._v("确定")])],1)},A=[],D=(i("a4d3"),i("e01a"),i("159b"),i("b0c0"),i("bfb4")),G=i("8656"),J={data:function(){return{callback:null,visible:!1,option:{description:"",groupId:null},users:[],onlineGroups:[],myOnlineGroups:[],showType:"my"}},props:{first:{type:Boolean}},created:function(){var t=this;Object(D["d"])().then((function(e){t.users=e}))},components:{HSelect:O},methods:{close:function(){this.option={},this.visible=!1,console.log("close")},show:function(t){var e=this;this.setUpOnlineGroups().then((function(){e.visible=!0,e.callback=t}))},submit:function(){""!==this.option.description.trim()?this.first&&null==this.option.groupId?this.$message.error("未选择文件夹"):this.callback(this.option,this.close):this.$message.error("描述不能为空")},setUpOnlineGroups:function(){var t=this,e=function(t){t.forEach((function(e){return e.children=t.filter((function(t){return t.parentId===e.id}))}));var e=function t(e){return{key:e.id,value:e.id,title:e.name,data:e,disabled:!e.optional,children:e.children.map((function(e){return t(e)}))}};return t.map((function(t){return e(t)}))};return Object(G["f"])().then((function(i){t.onlineGroups=e(i).filter((function(t){return 0===t.data.parentId})),t.myOnlineGroups=e(i.filter((function(t){return t.own}))).filter((function(t){return 0===t.data.parentId}))}))}}},M=J,F=(i("4140"),Object(f["a"])(M,z,A,!1,null,null,null)),H=F.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"option-dialog",visible:t.visible,width:"540px",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"title"},[t._v("上传资源")]),i("div",{staticClass:"main"},[i("a-upload",{attrs:{"file-list":t.fileList,remove:t.handleRemove,"before-upload":t.beforeUpload}},[i("a-button",{attrs:{size:"small"}},[i("a-icon",{attrs:{type:"upload"}}),t._v("选择文件 ")],1)],1),i("a-button",{staticStyle:{"margin-top":"5px"},attrs:{size:"small",type:"primary",disabled:0===t.fileList.length,loading:t.uploading},on:{click:t.handleUpload}},[t._v(" "+t._s(t.uploading?"上传中":"上传")+" ")]),t.fileInfos.length>0?i("div",{staticClass:"file-list"},t._l(t.fileInfos,(function(e,n){return i("div",{key:n,staticStyle:{padding:"5px 10px"}},[t._v(" "+t._s(e.name)+" "),i("a-badge",{staticStyle:{"margin-left":"10px"},attrs:{color:t.stateInfoMap[e.state].color,text:t.stateInfoMap[e.state].text}}),i("div",{staticClass:"msg"},[t._v(t._s(e.msg))])],1)})),0):t._e(),t.cache.length>0?i("div",{staticClass:"resource-list",staticStyle:{"margin-top":"10px"}},[t._v(" 已上传资源列表： "),t._l(t.cache,(function(e,n){return i("div",{key:n,staticStyle:{padding:"5px 10px","margin-top":"5px"}},[t._v(" "+t._s(e)+" ")])}))],2):t._e()],1)])},V=[],q=(i("fb6a"),i("99af"),i("1276"),"hera_resources_cache"),B=[{color:"#ffb800",text:"上传中"},{color:"#909399",text:"待上传"},{color:"#f50",text:"上传失败"},{color:"#87d068",text:"上传成功"}],U={data:function(){return{stateInfoMap:B,visible:!1,fileList:[],fileInfos:[],uploading:!1,cache:[]}},methods:{handleRemove:function(t){var e=this.fileList.indexOf(t),i=this.fileList.slice();i.splice(e,1),this.fileList=i},beforeUpload:function(t){return this.fileList=[].concat(Object(w["a"])(this.fileList),[t]),!1},handleUpload:function(){var t=this,e=this.fileList;e.forEach((function(e,i){var n=t.fileInfos.findIndex((function(t){return t.uid===e.uid}));-1===n&&(t.fileInfos.push({uid:e.uid,state:1,name:e.name}),n=t.fileInfos.length-1);var s=t.fileInfos[n];if(s.state>0&&s.state<3){var o=new FormData;o.append("fileFrom",e),o.append("file_id",i),s.state=0,t.$axios.post("/uploadResource/upload.do",o).then((function(e){console.log(e);try{var i=e.split("[上传成功]: ");console.log(i);var n=i[1].replace("<br>","");t.save2Local(n),s.msg=n}catch(o){console.log(o)}s.state=3})).catch((function(t){s.msg=t,s.state=2}))}}))},save2Local:function(t){this.cache.push(t),localStorage.setItem(q,JSON.stringify(this.cache))},getCacheFromLocal:function(){this.cache=JSON.parse(localStorage.getItem(q)||"[]")},close:function(){this.visible=!1},show:function(){this.visible=!0}}},K=U,W=(i("5d3c"),Object(f["a"])(K,P,V,!1,null,"264306a8",null)),Q=W.exports,X=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"job-search-dialog",visible:t.visible,width:"60%",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[i("div",{staticStyle:{"font-weight":"500"}},[t._v("任务搜索")]),t.resText?i("div",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.resText))]):t._e()]),i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("div",{staticStyle:{"margin-right":"10px"}},[t._v("tip: 双击进入搜索到的任务")]),i("h-select",{staticStyle:{width:"60px"},attrs:{options:t.statusOptions},on:{change:t.submit},model:{value:t.filter.auto,callback:function(e){t.$set(t.filter,"auto",e)},expression:"filter.auto"}}),i("h-select",{staticStyle:{width:"60px"},attrs:{options:t.typeOptions},on:{change:t.submit},model:{value:t.filter.runType,callback:function(e){t.$set(t.filter,"runType",e)},expression:"filter.runType"}})],1)]),t._l(t.inputArr,(function(e,n){return[t.inputCheckArr.includes(e.name)?i("a-input",{key:n,staticStyle:{"margin-top":"-1px"},attrs:{size:"small",placeholder:e.placeholder},on:{pressEnter:t.submit},model:{value:t.filter[e.name],callback:function(i){t.$set(t.filter,e.name,i)},expression:"filter[i.name]"}}):t._e()]})),i("div",{staticClass:"check-box"},t._l(t.inputArr,(function(e,n){return i("div",{key:n,class:["item",t.inputCheckArr.includes(e.name)?"active":""],on:{click:function(i){return t.toogleCheckInput(e.name)}}},[t._v(" "+t._s(e.placeholder)+" ")])})),0),i("div",{staticClass:"serach-result"},[t.result.length>0?[i("div",{staticClass:"list"},t._l(t.result,(function(e,n){return i("div",{key:n,class:["item",t.showedResItem.index===e.index?"active":""],on:{dblclick:function(i){return t.doubleClickResItem(e.id)},click:function(i){return t.chooseResultItem(e)}}},[i("span",{class:["icon",e.runType]},[t._v(" "+t._s(e.runType.substring(0,1))+" ")]),t._v(" ["+t._s(e.id)+"] "),i("div",{staticStyle:{"font-weight":"500",margin:"0 4px"},domProps:{innerHTML:t._s(e.name)}},[t._v(" "+t._s(e.name)+" ")]),t._v(" - "),i("div",{staticStyle:{"margin-left":"4px"},domProps:{innerHTML:t._s(e.description)}},[t._v(" "+t._s(e.description)+" ")])])})),0),t.showedResItem.scriptShow||t.showedResItem.configShow?i("div",{staticClass:"content"},[i("div",{staticClass:"tabs"},[t._l(t.tabs,(function(e){return[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showedResItem[e.value+"Show"],expression:"showedResItem[`${tab.value}Show`]"}],key:e.value,class:["tab",e.value===t.tabActive?"active":""],on:{click:function(i){return t.changeTab(e)}}},[t._v(" "+t._s(e.label)+" ")])]}))],2),i("div",{staticClass:"text",domProps:{innerHTML:t._s(t.showedResItemText)}})]):t._e()]:i("div",{staticClass:"empty"},[t._v(t._s(t.emptyText))])],2)],2)},Y=[],Z=["spark","shell","hive",{value:" ",label:"所有"}],tt=[{value:0,label:"关闭"},{value:1,label:"开启"},{value:2,label:"失效"},{value:" ",label:"所有"}],et=[{name:"script",placeholder:"脚本内容"},{name:"name",placeholder:"任务名称"},{name:"description",placeholder:"任务描述"},{name:"config",placeholder:"变量内容"}],it={data:function(){return{tabs:[{label:"脚本",value:"script"},{label:"配置项",value:"config"}],inputArr:et,typeOptions:Z,statusOptions:tt,visible:!1,callback:null,inputCheckArr:["script"],filter:{script:"",name:"",description:"",config:"",runType:" ",auto:" "},result:[],showedResItem:null,tabActive:"script",emptyText:"输入关键字进行查询"}},components:{HSelect:O},computed:{resText:function(){var t=this.result,e=[],i=0;return t.forEach((function(t){e.includes(t.id)||(e.push(t.id),i+=t.matchCount)})),t.length>0?"从".concat(e.length,"个任务中获得").concat(i,"处匹配"):null},showedResItemText:function(){var t=this.showedResItem;return t[this.tabActive]}},methods:{toogleCheckInput:function(t){var e=this.inputCheckArr;if(e.includes(t)){if(1===e.length)return;var i=e.findIndex((function(e){return e==t}));e.splice(i,1),this.filter[t]=""}else e.push(t)},chooseResultItem:function(t){this.showedResItem=t},changeTab:function(t){this.tabActive=t.value},submit:function(){var t=this,e=this.filter;""!==e.name||""!=e.description||""!=e.config||""!==e.script?(this.result=[],this.emptyText="正在查询中，请稍等……",Object(b["B"])(this.filter).then((function(e){var i=[];e.forEach((function(t,e){var n="",s="",a=!1,r=!1,c=0;t.config.split("<br>").forEach((function(t,e){""!==t&&(n+="<div class='line'><span class='number'>".concat(e+1," </span>").concat(t,"</div>"),t.includes("<font color='red'>")&&(r=!0,c++))})),t.script.split("<br>").forEach((function(t,e){""!==t&&(s+="<div class='line'><span class='number'>".concat(e+1," </span>").concat(t,"</div>"),t.includes("<font color='red'>")&&(a=!0,c++))})),i.push(Object(o["a"])(Object(o["a"])({},t),{},{config:n,script:s,index:e,configShow:r,scriptShow:a,matchCount:c}))})),t.result=i,t.showedResItem=i[0],0===i.length&&(t.emptyText="没有找到匹配，请更换关键词重新查询")})).catch((function(){t.emptyText="查询异常，请重新查询"}))):this.$message.warn("查询条件不能为空")},doubleClickResItem:function(t){this.callback&&this.callback(t)},close:function(){this.visible=!1,this.filter={script:"",name:"",description:"",config:"",runType:" ",auto:" "},this.result=[],this.emptyText="输入关键字进行查询",this.inputCheckArr=["script"]},show:function(t){this.visible=!0,this.callback=t}}},nt=it,st=(i("be85"),Object(f["a"])(nt,X,Y,!1,null,null,null)),ot=st.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"setting-dialog",visible:t.visible,width:"300px",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"container"},[i("div",{staticClass:"content"},[i("div",{staticClass:"form-line"},[i("a-checkbox",{model:{value:t.setting.showTabs,callback:function(e){t.$set(t.setting,"showTabs",e)},expression:"setting.showTabs"}},[t._v(" 多标签页&缓存任务 ")])],1),i("div",{staticClass:"form-line"},[i("a-checkbox",{model:{value:t.setting.hideEmptyFolder,callback:function(e){t.$set(t.setting,"hideEmptyFolder",e)},expression:"setting.hideEmptyFolder"}},[t._v(" 不显示空文件夹 ")])],1),i("div",{staticClass:"form-line"},[i("a-checkbox",{model:{value:t.setting.hideClosedJob,callback:function(e){t.$set(t.setting,"hideClosedJob",e)},expression:"setting.hideClosedJob"}},[t._v(" 不显示关闭的任务 ")])],1),i("div",{staticClass:"form-line"},[i("a-checkbox",{model:{value:t.setting.compareBeforeSave,callback:function(e){t.$set(t.setting,"compareBeforeSave",e)},expression:"setting.compareBeforeSave"}},[t._v(" 保存前进行代码比较 ")])],1),i("div",{staticClass:"form-line"},[i("a-checkbox",{model:{value:t.setting.restoreFromLocal,callback:function(e){t.$set(t.setting,"restoreFromLocal",e)},expression:"setting.restoreFromLocal"}},[t._v(" 刷新后读取缓存 ")])],1),i("div",{staticClass:"form-line"},[i("div",{staticStyle:{width:"120px","font-size":"14px","margin-bottom":"10px","font-weight":"500"}},[t._v(" 全部任务显示 ")]),i("a-radio-group",{attrs:{options:[{value:!0,label:"所有任务"},{value:!1,label:"只是组内任务"}]},model:{value:t.setting.showAll,callback:function(e){t.$set(t.setting,"showAll",e)},expression:"setting.showAll"}})],1)])])])},rt=[],ct={data:function(){return{visible:!1}},watch:{setting:{handler:function(){this.$store.commit("develop/saveLocalLayout")},deep:!0},"setting.showAll":{handler:function(){this.$store.dispatch("develop/initJobs")}}},computed:{setting:function(){return this.$store.getters["develop/depSetting"]}},methods:{show:function(){this.visible=!0},close:function(){this.visible=!1}}},lt=ct,ut=(i("8e11"),i("4f44"),Object(f["a"])(lt,at,rt,!1,null,"2d52461b",null)),dt=ut.exports,ft=i("10f8"),ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.jobId?i("a-modal",{attrs:{wrapClassName:"run-option-dialog",visible:t.visible,width:"90%",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("dependency-graph",{ref:"dg",staticStyle:{height:"calc(100vh - 160px)"},attrs:{jobId:t.jobId,modal:!0,graphName:"graph2"}},[i("svg",{staticClass:"graph",attrs:{id:"graph2",height:"100%",width:"100%"}},[i("g")])])],1):t._e()},pt=[],mt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"operation-container operation-bar"},[i("h-select",{staticStyle:{width:"70px","margin-right":"10px"},attrs:{options:t.dayNumOptions},on:{change:t.changeDayNum},model:{value:t.dayNum,callback:function(e){t.dayNum=e},expression:"dayNum"}}),i("a",{staticStyle:{"font-size":"10px","line-height":"25px"},on:{click:t.showAll}},[t._v("展开全部")])],1),i("div",{staticClass:"text-container"},[t.hoverNode?i("span",[i("p",{},[t._v(t._s(t.hoverNode.remark))]),"start_node"===t.hoverNode.remark?i("span",[t._v(" 鼠标放在节点上查看执行情况")]):i("div",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.copy(t.hoverNode.children.join(" "))}}},[t.hoverNode.children.length>0?[t._v(" "+t._s("up"===t.type?"上游":"下游")+"依赖（点击复制）: "),t._l(t.hoverNode.children,(function(e){return i("span",{key:e,staticStyle:{"margin-right":"6px",border:"1px solid #e6e6e6",padding:"1px 5px"}},[t._v(t._s(e))])}))]:i("div",[t._v("无依赖")])],2)]):t._e()]),i("div",{staticClass:"graph-container"},[i("div",{staticClass:"tool-bar"},[i("div",{staticClass:"tool-item",on:{click:function(){t.type="up"===t.type?"down":"up"}}},[t._v(" "+t._s("up"===t.type?"上游":"下游")+" ")]),i("div",{staticClass:"tool-item",staticStyle:{"margin-right":"10px"},on:{click:function(){t.rankdir="LR"===t.rankdir?"TB":"LR"}}},[t._v(" "+t._s("LR"===t.rankdir?"横向":"纵向")+" ")]),t._l([{value:"list",label:"层级"},{value:"graph",label:"dag图"},{value:"track",label:"执行过程"},{value:"gantt",label:"甘特图"}],(function(e){return i("div",{key:e.value,staticClass:"tool-item",class:[t.showType===e.value?"active":""],on:{click:function(){t.showType=e.value}}},[t._v(" "+t._s(e.label)+" ")])}))],2),"list"===t.showType?i("div",{class:["chain","LR"===t.rankdir?"row":"column"]},t._l(t.nodesChain,(function(e,n){return i("div",{key:n,staticClass:"list"},[e.length>0?i("div",{staticClass:"title"},[t._v("层级"+t._s(n+1))]):t._e(),e.length>0?t._l(e,(function(e){return i("div",{key:e.id,class:["node",t.nodeIdChain[n+1]===e.id?"active":""],style:{color:t.getColor(e.data.auto,e.remark)},on:{click:function(i){return t.showChild(e.id,n)}}},[t._v(" "+t._s(e.label)+" ")])})):i("div",{staticStyle:{padding:"10px","font-size":"12px"}},[t._v("无依赖")])],2)})),0):"graph"===t.showType?[t._t("default",[i("svg",{staticClass:"graph",attrs:{id:"graph",height:"100%",width:"100%"}},[i("g")])])]:"track"===t.showType?i("div",{staticStyle:{padding:"30px 10px 0 10px",height:"calc(100% - 20px)"}},[i("job-track-graph",{ref:"jobTrackGraphRef",attrs:{filter:t.trackGraphFilter}})],1):i("div",{staticStyle:{"margin-top":"30px","text-align":"center","font-size":"20px"}},[t._v(" 待开发 ")])],2)])},vt=[],bt=i("b85c"),gt=(i("5db7"),i("73d9"),i("884e")),yt=i("5698"),_t=i("1226"),Ct=i.n(_t),xt=[{label:"今天",value:0},{label:"昨天",value:1},{label:"前天",value:2},{label:"三天前",value:3},{label:"四天前",value:4},{label:"五天前",value:5},{label:"六天前",value:6}],kt=new Ct.a.render;function wt(t,e){return null==t?"#bd16ff":0==t?"#919191":e.includes("success")?"#60A766":e.includes("running")?"#f5c66f":"#D6595D"}function jt(t,e){var i,n=[],s={},o=Object(bt["a"])(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;s[a[e]]||(n.push(a),s[a[e]]=1)}}catch(r){o.e(r)}finally{o.f()}return n}var Tt={},It={name:"dependency-graph",props:{jobId:{reuqire:!0,type:[String,Number]},graphName:{require:!1,default:function(){return"graph"},type:String}},data:function(){return{dayNumOptions:xt,dayNum:0,edges:[],nodes:[],hoverNode:null,type:"up",rankdir:"TB",visible:!1,clickNodeIds:[],nodeIdChain:[],showType:"graph"}},mounted:function(){this.cacheDraw()},watch:{jobId:function(){this.cacheDraw()},hoverNode:function(t){this.save2Cache(t,"hoverNode")},type:function(t){this.save2Cache(t,"type"),this.fetchDataAndShow()},dayNum:function(t){this.save2Cache(t,"dayNum")},rankdir:function(t){this.save2Cache(t,"rankdir"),this.fetchDataAndShow(this.clickNodeIds,this.nodeIdChain)},clickNodeIds:function(t){this.save2Cache(t,"clickNodeIds")},showType:function(t){"graph"===t&&this.fetchDataAndShow(this.clickNodeIds),this.save2Cache(t,"showType")},nodeIdChain:function(t){this.save2Cache(t,"nodeIdChain")}},components:{HSelect:O,JobTrackGraph:gt["a"]},computed:{nodesChain:function(){var t=this,e=this.nodeIdChain;return e.map((function(e){return t.nodes.filter((function(i){return t.getChlidNodeIds(e).includes(i.id)}))}))},trackGraphFilter:function(){var t=new Date;t.setHours(0,0,0,0);var e=t.getTime(),i=864e5,n=e-(this.dayNum-1)*i,s=e-this.dayNum*i;return{userId:null,periodType:"none",triggerType:1,dateFrom:s,dateTo:n,jobId:this.jobId}}},methods:{changeDayNum:function(){var t=this;"track"===this.showType?this.$nextTick((function(){t.$refs.jobTrackGraphRef.init()})):this.fetchDataAndShow()},getColor:wt,showChild:function(t,e){this.nodeIdChain.splice(e+1,this.nodeIdChain.length-e),this.nodeIdChain.push(t),this.hoverNode=Object(o["a"])(Object(o["a"])({},this.nodes.find((function(e){return e.id===t}))),{},{children:this.getChlidNodeIds(t)})},showAll:function(){this.clickNodeIds=jt(Object(w["a"])(this.nodes),"id").map((function(t){return t.id})),this.drawGraph()},getChlidNodeIds:function(t){var e=this;return this.edges.filter((function(i){return t===("down"===e.type?i.source:i.target)})).map((function(t){return"down"===e.type?t.target:t.source}))},getDrawedInfo:function(t,e){var i=this,n=this.nodes.find((function(t){return t.id===e})),s=[n],o=this.type,a=[];0!==e&&a.push({source:"down"===o?t:e,target:"down"===o?e:t});var r=[].concat(a);return this.clickNodeIds.includes(e)&&this.getChlidNodeIds(e).forEach((function(t){var n=i.getDrawedInfo(e,t),o=n.nodes,a=n.edges;s=s.concat(o),r=r.concat(a)})),{edges:r,nodes:s}},save2Cache:function(t,e){var i=Tt[this.jobId];i&&(i[e]=t)},cacheDraw:function(){var t=Tt[this.jobId];t?(this.clickNodeIds=t.clickNodeIds||[],this.hoverNode=t.hoverNode,this.type=t.type,this.dayNum=t.dayNum,this.rankdir=t.rankdir,this.edges=t.edges,this.nodes=t.nodes,this.showType=t.showType,this.nodeIdChain=t.nodeIdChain||[0],this.drawGraph()):(this.hoverNode=null,this.dayNum=0,this.fetchDataAndShow())},fetchDataAndShow:function(t,e){var i=this,n=this.type;return Object(b["f"])(this.jobId,"up"===n?0:1,this.dayNum).then((function(s){var a=s.edges.map((function(t){return{source:"up"===n?t.nodeB.nodeName:t.nodeA.nodeName,target:"up"===n?t.nodeA.nodeName:t.nodeB.nodeName}})),r=s.edges.map((function(t){return[t.nodeA,t.nodeB]})).flatMap((function(t){return t})).map((function(t){return{data:Object(o["a"])({},t),label:t.nodeDesc,id:t.nodeName,style:"fill: ".concat(wt(t.auto,t.remark)),class:"graph-node",remark:t.remark}})),c=jt(Object(w["a"])(r),"id");i.edges=a,i.nodes=c,i.hoverNode=r.find((function(t){return 0===t.id})),i.clickNodeIds=t||[0],i.nodeIdChain=e||[0],i.drawGraph(),Tt[i.jobId]={edges:a,nodes:c,type:i.type,hoverNode:i.hoverNode,dayNum:i.dayNum,rankdir:i.rankdir,showType:i.showType,nodeIdChain:i.nodeIdChain,clickNodeIds:i.clickNodeIds}}))},drawGraph:function(){if("graph"===this.showType){var t=document.querySelector("#".concat(this.graphName," g"));while(t.firstChild)t.removeChild(t.firstChild);var e=this.getDrawedInfo(0,0),i=e.nodes,n=e.edges;this.draw(i,n)}},draw:function(t,e){var i=this;t=jt(Object(w["a"])(t),"id");var n=(new Ct.a.graphlib.Graph).setGraph({rankdir:this.rankdir}).setDefaultEdgeLabel((function(){return{}}));t.forEach((function(t){return n.setNode(t.id,t)})),e.forEach((function(t){return n.setEdge(t.source,t.target,{})})),n.nodes().forEach((function(t){var e=n.node(t);e.rx=e.ry=5}));var s=yt["select"]("#".concat(this.graphName)),a=s.select("g"),r=yt["zoom"]().on("zoom",(function(){return a.attr("transform",yt["event"].transform)}));s.call(r),kt(a,n),s.call(r.transform,yt["zoomIdentity"].translate(50,50).scale(.75)),a.selectAll(".graph-node").on("mousemove",(function(t){var e=jt(Object(w["a"])(i.nodes),"id"),n=Number(t);i.hoverNode=Object(o["a"])(Object(o["a"])({},e.find((function(t){return t.id===n}))),{},{children:i.getChlidNodeIds(n)})})),a.selectAll(".graph-node").on("click",(function(t){var e=Number(t);if(0!==e){var n=i.clickNodeIds.findIndex((function(t){return t==e}));-1===n?i.clickNodeIds.push(e):i.clickNodeIds.splice(n,1),i.drawGraph()}}))},copy:function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();var i=document.execCommand("copy");i&&this.$message.success("复制成功！"),document.body.removeChild(e)}}},St=It,Ot=(i("4cf5"),i("219b"),Object(f["a"])(St,mt,vt,!1,null,"67598b64",null)),$t=Ot.exports,Et={data:function(){return{visible:!1,jobId:null}},components:{DependencyGraph:$t},methods:{show:function(t){var e=this;this.jobId=t,this.visible=!0,this.$nextTick((function(){e.$refs.dg.cacheDraw()}))},close:function(){this.jobId=null,this.visible=!1}}},Nt=Et,Rt=Object(f["a"])(Nt,ht,pt,!1,null,null,null),Lt=Rt.exports,zt=[{icon:"setting",tip:"设置"},{icon:"clean",tip:"清理浏览器缓存",divider:!0},{icon:"search",tip:"查找任务"},{icon:"refresh",divider:!0,tip:"刷新"},{icon:"save",disabled:!1,tip:"保存"},{icon:"infinite",disabled:!0,tip:"生成版本"},{icon:"play",disabled:!0,divider:!1,tip:"运行"},{icon:"publish",disabled:!0,divider:!1,tip:"发布"},{icon:"quality",disabled:!0,divider:!1,tip:"质量上线"},{icon:"dependency",disabled:!0,tip:"依赖执行历史"},{icon:"upload",disabled:!1,divider:!0,tip:"上传资源"},{icon:"valid",func:function(t){return t?"forbidden":"yes"},disabled:!0,tip:function(t){return"".concat(t?"关闭":"开启","任务")}},{icon:"focus",func:function(t){return"eye-".concat(t?"close":"open")},disabled:!0,tip:function(t){return"".concat(t?"取消":"","关注任务")},divider:!0},{icon:"formatter",disabled:!0,tip:"代码格式化"},{icon:"compare",disabled:!0,tip:"比较代码"},{icon:"history",disabled:!0,tip:"历史代码"},{icon:"rollback",disabled:!0,tip:"回滚",divider:!0}],At={mixins:[r],data:function(){return{buttons:zt,showButton:!1}},components:{RunOptionDialog:L,Setting:dt,CodeCompare:ft["a"],PublishOptionDialog:H,UploadOptionDialog:Q,JobSearchDialog:ot,JobDependencyDialog:Lt},computed:{noPublishes:function(){var t,e,i;return!(!this.isSelectedGroup&&(null===(t=this.job)||void 0===t||null===(e=t.publishes)||void 0===e||null===(i=e.filter((function(t){return"success"===t.state})))||void 0===i?void 0:i.length)>0)}},methods:{full:function(){y.a.toggle(),this.$store.commit("setting/toggleFullScreen")},save:function(t){var e=this;return this.$store.dispatch("develop/updateJobScript",{id:t}).then((function(){e.$message.success("保存成功！")}))},buttonClick:function(t){var e=this,i=t.icon;if(console.log(i),"refresh"===i)this.$store.dispatch("develop/initJobs").then((function(){e.isSelectedGroup?(e.$store.dispatch("develop/getGroup",e.group.id),e.$message.success("刷新成功！")):e.$message.success("刷新成功！")}));else if("clean"===i)this.$store.commit("develop/clearAllCache"),location.reload();else if("setting"===i)this.$refs.settingRef.show();else if("search"===i)this.$refs.jobSerachRef.show((function(t){e.$store.dispatch("develop/searchSelectNode",t).then((function(){e.$refs.jobSerachRef.close()})).catch((function(t){e.$message.error(t)}))}));else if("upload"===i)this.$refs.uploadOptionRef.show();else if(this.isSelectedGroup)"save"===i?this.$store.dispatch("develop/updateGroupConfigs",{groupId:this.group.id,selfConfigs:this.group.selfConfigs}).then((function(){e.$message.success("保存成功！")})):"focus"===i&&console.log("关注");else{var n,s=null===(n=this.job)||void 0===n?void 0:n.id;if("infinite"===i)Object(b["h"])(s).then((function(){e.$store.dispatch("develop/getJobVersions",{jobId:s}).then((function(){e.$message.success("生成版本成功！")}))}));else if("play"===i){var a;if(null!==(a=this.selectedTabNode)&&void 0!==a&&a.origin.edited)return void this.$message.warn("有修改未保存! ");this.$refs.runOptionRef.show(this.job.versions,(function(t){t.actionId?e.$store.dispatch("develop/runJob",Object(o["a"])(Object(o["a"])({},t),{},{jobId:s})).then((function(){6===t.triggerType&&e.$message.info("已提交，超级恢复请让管理员审批")})):e.$message.error("请先生成版本再执行! ")}))}else if("publish"===i)this.$refs.publishOptionRef.show((function(t,i){e.$store.dispatch("develop/createJobPublish",Object(o["a"])(Object(o["a"])({},t),{},{jobId:s,script:e.job.script,configs:e.job.configs})).then((function(){return i()}))}));else if("save"===i)this.depSetting.compareBeforeSave?Object(b["q"])(s).then((function(t){e.compareCode(Object(o["a"])(Object(o["a"])({},t),{},{description:"此时服务端最新代码"})),e.showButton=!0})):this.save(s);else if("valid"===i){var r=!this.job.valid;this.$store.dispatch("develop/setJobValidOrNot",{id:s,valid:r}).then((function(){e.$message.success("".concat(r?"开启":"关闭","成功！"))}))}else if("focus"===i){var c=!this.getRes("focus");this.$store.dispatch("develop/focusJobOrNot",{id:s,focus:c,user:this.getUser()}).then((function(){e.$message.success("".concat(c?"":"取消","关注成功！"))}))}else if("compare"===i){this.showButton=!1;var l={selfConfigs:this.selectedTabNode.origin.selfConfigs,script:this.selectedTabNode.origin.script,description:"修改前"};this.compareCode(l)}else"formatter"===i?this.$store.dispatch("develop/formatScript"):"dependency"===i?this.$refs.jobDependencyDialogRef.show(s):"quality"===i?Object(b["y"])(s).then((function(){e.$message.success("发送成功！")})).catch((function(t){e.$message.error(t)})):this.$message.warn(this.buttonTip(t)+"暂不支持，待开发！")}},compareCode:function(t){var e={selfConfigs:this.job.selfConfigs,script:this.job.script,description:"修改后"};this.$refs.codeCompareRef.show(this.job.lang,t,e)},buttonIcon:function(t){return t.func?t.func(this.getRes(t.icon)):t.icon},buttonTip:function(t){return"function"===typeof t.tip?t.tip(this.getRes(t.icon)):t.tip},getRes:function(t){var e;if("valid"===t)return null===(e=this.job)||void 0===e?void 0:e.valid;if("focus"===t){var i=this.getUser();if(i){var n,s=this.isSelectedGroup?this.group:this.job;return null===s||void 0===s||null===(n=s.focusUsers)||void 0===n?void 0:n.includes(i)}}},getUser:function(){return(localStorage.getItem("ssoName")||"").replace("用户:","").trim()}}},Dt=At,Gt=(i("fcb3"),i("719e"),Object(f["a"])(Dt,m,v,!1,null,"3f79b3d4",null)),Jt=Gt.exports,Mt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("tabs",{staticClass:"tabs",attrs:{mode:"horizontal",tabs:t.tabs.bottom,active:t.bottomTab.name},on:{change:function(e){return t.changeTab(e.name,"bottom")}}})],1)},Ft=[],Ht={mixins:[r],components:{Tabs:p}},Pt=Ht,Vt=(i("6f4f4"),Object(f["a"])(Pt,Mt,Ft,!1,null,"6af25a00",null)),qt=Vt.exports,Bt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"tabs-container left"},[t._t("left-side")],2),i("div",{staticClass:"center"},[i("split-pane",{attrs:{show:[!0,t.bottomTab.width],mode:"horizontal"},on:{resize:function(e){return t.changeTabSize(100-e,"bottom")}}},[i("template",{slot:"left"},[i("split-pane",{attrs:{show:[t.leftTab.width,!0]},on:{resize:function(e){return t.changeTabSize(e,"left")}}},[i("template",{slot:"left"},[t._t("left")],2),i("template",{slot:"right"},[i("split-pane",{attrs:{show:[!0,t.rightTab.width]},on:{resize:function(e){return t.changeTabSize(100-e,"right")}}},[i("template",{slot:"left"},[t._t("center")],2),i("template",{slot:"right"},[t._t("right")],2)],2)],1)],2)],1),i("template",{slot:"right"},[t._t("bottom")],2)],2)],1),i("div",{staticClass:"tabs-container right"},[t._t("right-side")],2)])},Ut=[],Kt=i("6983"),Wt={mixins:[r],data:function(){return{}},components:{SplitPane:Kt["a"]},methods:{resize:function(){}}},Qt=Wt,Xt=(i("783b"),Object(f["a"])(Qt,Bt,Ut,!1,null,"3f7aee43",null)),Yt=Xt.exports,Zt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("attached-header",{attrs:{type:"left"},scopedSlots:t._u([{key:"header",fn:function(){return[t.filterObj.visible?t._e():i("span",{staticStyle:{"margin-right":"5px",cursor:"pointer"},on:{click:t.search}},[t._v(t._s(t.filterObj.value))]),i("my-icon",{staticClass:"icon",attrs:{type:"hera_icon_target3"},on:{click:t.findTarget}}),i("a-icon",{staticClass:"icon",attrs:{type:"search"},on:{click:t.search}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.filterObj.visible,expression:"filterObj.visible"}],staticClass:"tree-filter operation-bar"},[i("a-input",{ref:"filterInput",staticStyle:{margin:"0 5px"},attrs:{size:"small",placeholder:"ID/名称回车过滤,多个空格分隔"},on:{pressEnter:t.startFilter},model:{value:t.filterObj.text,callback:function(e){t.$set(t.filterObj,"text",e)},expression:"filterObj.text"}}),i("a-icon",{staticClass:"icon",staticStyle:{"margin-right":"5px"},attrs:{type:"close"},on:{click:function(e){t.filterObj.visible=!1}}})],1)]},proxy:!0}])},t._l(["allJob","myJob","debug"],(function(e){return i("job-tree",{directives:[{name:"show",rawName:"v-show",value:t.leftTab.name===e,expression:"leftTab.name === tab"}],key:e,staticClass:"tree",attrs:{"tree-cache":t.treeCache(e),"tree-data":t.treeData(e)},on:{expand:function(i){return t.changeFilteredExpanedTreeNodes(e,i)},select:t.selectTreeNode,menuClick:t.menuClick}})})),1),i("create-job-dialog",{ref:"createJobDialogRef"})],1)},te=[],ee=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"create-job-dialog",visible:t.visible,width:"240px",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[i("div",{staticClass:"container"},[i("div",{staticClass:"title"},[t._v(" "+t._s(t.title)+" ")]),i("a-input",{ref:"nameInput",attrs:{size:"small",placeholder:t.oldName+"/"},on:{pressEnter:t.submit},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[i("template",{slot:"prefix"},[t.isCreateJob?i("span",{class:["icon",t.jobType]},[t._v(" "+t._s(t.jobType.substring(0,1))+" ")]):t.isCreateGroup?i("a-icon",{class:["group-icon",t.groupType],attrs:{type:"folder",theme:"filled"}}):t.isRename?[t.obj.type.includes("dic")?i("a-icon",{class:["group-icon",t.obj.type],attrs:{type:"folder",theme:"filled"}}):i("span",{class:["icon",t.obj.runType]},[t._v(" "+t._s((t.obj.runType||"?").substring(0,1))+" ")])]:t._e()],2)],2),i("div",{staticClass:"type-select"},[t.isCreateJob?t._l(t.jobTypes,(function(e){return i("div",{key:e,class:["type",e===t.jobType?"active":""],on:{click:function(i){t.jobType=e}}},[i("span",{class:["icon",e]},[t._v(" "+t._s(e.substring(0,1))+" ")]),i("span",[t._v(t._s(e))])])})):t.isCreateGroup?t._l(t.groupTypes,(function(e){return i("div",{key:e.name,class:["type",e.name===t.groupType?"active":""],on:{click:function(i){t.groupType=e.name}}},[i("a-icon",{class:["group-icon",e.name],attrs:{type:"folder",theme:"filled"}}),t._v(" "+t._s(e.title)+" ")],1)})):t._e()],2)],1)])},ie=[],ne=["Spark","Hive","Shell"],se=[{name:"big_dic",title:"大目录"},{name:"small_dic",title:"小目录"}],oe={data:function(){return{jobTypes:ne,groupTypes:se,visible:!1,jobType:"Spark",groupType:"small_dic",name:"",data:{},callback:null}},computed:{oldName:function(){var t;return null===(t=this.obj)||void 0===t?void 0:t.name.split("(")[0]},obj:function(){return this.data.obj},title:function(){return this.data.order},isCreateJob:function(){return"新建任务"===this.title},isRename:function(){return"重命名"===this.title},isCreateGroup:function(){return"新建文件夹"===this.title},isCopy:function(){return"复制"===this.title}},methods:{show:function(t,e){var i=this;this.data=t,this.isRename&&(this.name=this.oldName),this.visible=!0,this.callback=e,this.$nextTick((function(){i.$refs.nameInput.focus()}))},submit:function(){var t={};""!==this.name.trim()?(this.visible=!1,this.isCreateGroup?t={directory:"big_dic"===this.groupType?0:1,name:this.name,parentId:this.obj.id}:this.isCreateJob?t={runType:this.jobType.toLowerCase(),name:this.name,parentId:"group_".concat(this.obj.id)}:(this.isCopy||this.isRename)&&(t={name:this.name}),this.callback(this.data.order,t),this.close()):this.$message.error("name不能为空！")},close:function(){this.visible=!1,this.jobType="Spark",this.groupType="small_dic",this.name="",console.log("close",this.name)}}},ae=oe,re=(i("753a"),Object(f["a"])(ae,ee,ie,!1,null,null,null)),ce=re.exports,le=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"header"},[t._v(" "+t._s(t.title)+" "),i("div",{staticClass:"operation-bar"},[t._t("header"),i("a-icon",{staticClass:"icon",attrs:{type:"minus"},on:{click:t.close}})],2)]),i("div",{staticClass:"content"},[t._t("default")],2)])},ue=[],de={props:{type:{required:!0,type:String}},mixins:[r],computed:{title:function(){var t=this;return this.tabs[this.type].find((function(e){return e.name===t.name})).label},name:function(){return this.tabActive(this.type).name}},methods:{close:function(){this.changeTab(this.name,this.type)}}},fe=de,he=(i("2a59"),Object(f["a"])(fe,le,ue,!1,null,"2c941225",null)),pe=he.exports,me=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.treeData.length>0?i("div",{staticClass:"container"},[i("a-directory-tree",{attrs:{icon:t.getIcon,blockNode:!0,"show-icon":"",draggable:!0,"tree-data":t.treeData,selectedKeys:t.treeCache.selectedKeys,expandedKeys:t.treeCache.expandedKeys},on:{"update:selectedKeys":function(e){return t.$set(t.treeCache,"selectedKeys",e)},"update:selected-keys":function(e){return t.$set(t.treeCache,"selectedKeys",e)},"update:expandedKeys":function(e){return t.$set(t.treeCache,"expandedKeys",e)},"update:expanded-keys":function(e){return t.$set(t.treeCache,"expandedKeys",e)},expand:function(e,i){var n=i.expanded,s=i.node;return t.$emit("expand",{keys:e,expanded:n,node:s})},select:t.selectNode,rightClick:t.rightClick,dragend:t.dragNodeEnd,dragenter:t.dragNodeEnter,dragstart:t.dragNodeStart},scopedSlots:t._u([{key:"title",fn:function(e){return[i("span",{class:{title:!0,selected:e.selected}},[!e.dataRef.dic&&t.depSetting.showId?i("span",[t._v("["+t._s(e.origin.id)+"] ")]):t._e(),t._v(t._s(e.title))])]}}],null,!1,3688686318)}),i("right-menu",{ref:"rightMenu"})],1):t._e()},ve=[],be=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.visible?i("div",{staticClass:"menu",style:{top:t.top,left:t.left}},[i("a-menu",{attrs:{slot:"overlay",size:"small"},slot:"overlay"},[t._l(t.menus,(function(e){return[e.children&&e.children.length>0?i("a-sub-menu",{key:e.title,staticClass:"sub-menu"},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.title))]),t._l(e.children,(function(n){return i("a-menu-item",{key:n.title,staticClass:"menu-item",on:{click:function(i){return t.onClick(e.title)}}},[t._v(" "+t._s(n.title)+" ")])}))],2):i("a-menu-item",{key:e.title,staticClass:"menu-item",on:{click:function(i){return t.onClick(e.title)}}},[t._v(" "+t._s(e.title)+" ")])]}))],2)],1):t._e()},ge=[];function ye(t){return t.map((function(t){var e=t;return t instanceof Object||(e={title:t}),Object(o["a"])(Object(o["a"])({},e),{},{children:ye(e.children||[])})}))}var _e={data:function(){return{visible:!1,top:"",left:"",menus:[],obj:{},callback:null}},components:{},methods:{show:function(t,e){this.menus=ye(t),this.visible=!0,this.callback=e,this.left=event.clientX+10+"px",this.top=event.clientY+"px",document.addEventListener("click",this.foo)},foo:function(){this.visible=!1,document.removeEventListener("click",this.foo)},onClick:function(t){this.callback(t)}}},Ce=_e,xe=(i("1c8e"),i("b86b"),Object(f["a"])(Ce,be,ge,!1,null,null,null)),ke=xe.exports,we={props:{treeData:{type:Array,required:!0,default:function(){return[]}},treeCache:{type:Object,default:function(){return{expandedKeys:[],selectedKeys:[]}}}},data:function(){return{dragNodeInfo:{from:null,to:null}}},components:{RightMenu:ke},computed:{depSetting:function(){return this.$store.getters["develop/depSetting"]}},methods:{getIcon:function(t){var e=this.$createElement,i=t.expanded,n=t.type,s=t.selected;return"dic"===t.scopedSlots.icon?e("a-icon",{class:["tree-icon",n,s?"selected":""],attrs:{theme:"filled",type:i?"folder-open":"folder"}}):"job"===t.scopedSlots.icon?e("a-icon",{class:["tree-icon",n,s?"selected":""],attrs:{theme:"filled",type:"file"}}):"title"===t.scopedSlots.title?e("span",{class:{title:!0,selected:t.selected}},[e("span",{directives:[{name:"if",value:!t.dataRef.dic&&this.depSetting.showId}]},["[ props.origin.id ]"," "])," ","props.title"," "]):void 0},selectNode:function(t,e){var i=e.node;this.$emit("select",{key:i.dataRef.key,selected:i.selected,dic:i.dataRef.dic,id:i.dataRef.id})},rightClick:function(t){var e=this,i=t.node,n=i.dataRef,s=[];n.dic?"small_dic"===n.type?s.push("新建任务"):s.push("新建文件夹"):s.push("复制"),this.$refs.rightMenu.show(s.concat(["删除"]),(function(t){e.$emit("menuClick",t,Object(o["a"])(Object(o["a"])({},n.origin),{},{key:n.key}))}))},dragNodeEnd:function(){var t=this,e=this.dragNodeInfo;if(e.from&&e.to){var i=e.from.dic?"group_".concat(e.from.id):e.from.id,n=e.from.origin.parent,s="group_".concat(e.to.id);if(n===s)return;if(e.from.dic&&"small_dic"===e.to.type)return void this.$message.error("小目录中不允许有目录");if(!e.from.dic&&"big_dic"===e.to.type)return void this.$message.error("大目录中不允许有任务");Object(b["w"])(i,n,s).then((function(){i!==s&&t.$store.dispatch("develop/initJobs").then((function(){t.$message.success("移动成功！")}))}))}},dragNodeEnter:function(t){var e=t.node;e.dataRef.dic?this.dragNodeInfo.to=e.dataRef:this.dragNodeInfo.to=null},dragNodeStart:function(t){var e=t.node;this.dragNodeInfo.from=e.dataRef}}},je=we,Te=(i("df6a"),i("e277"),Object(f["a"])(je,me,ve,!1,null,"328e2339",null)),Ie=Te.exports;function Se(t,e,i){var n=[];return t.forEach((function(t){if(t.isLeaf)i||(i=function(t,e){return t.title.includes(e)}),i(t,e)&&n.push(t);else{var s=Object(o["a"])(Object(o["a"])({},t),{},{children:Se(t.children,e,i)});(i(s,e)||s.children.length>0)&&n.push(s)}})),n}var Oe={visible:!1,value:"",text:"",excludeNodes:[]},$e={mixins:[r],data:function(){return{filterObj:{visible:!1,value:"",text:"",excludeNodes:[]}}},watch:{filterObj:{handler:function(t){Object.assign(Oe,t)},deep:!0}},components:{JobTree:Ie,AttachedHeader:pe,CreateJobDialog:ce},created:function(){this.filterObj=Object(o["a"])({},Oe)},computed:{treeDataTuple:function(){return function(t){var e=this,i=this.jobTrees[t],n=[],s=Se(i,this.filterObj.value,(function(t,i){if(i=i.trim(),""===i)return e.ignoreEmpty(t)&&e.ignoreCloseJob(t);var s=function(i){var s=t.dic?t.title:t.origin.jobName,o=s.includes(i)||t.origin.id.toString()===i;return(t.children.filter((function(t){return t.searched})).length>0||o)&&(t.searched=!0,t.isLeaf||n.push(t)),e.ignoreEmpty(t),e.ignoreCloseJob(t),o};if(i.includes(" ")){var o=i.split(" ").filter((function(t){return""!==t}));if(o)return o.map((function(t){return s(t)})).filter((function(t){return t})).length>0}return s(i)}));return{filterData:s,expandedNodes:n}}},treeData:function(){return function(t){return this.treeDataTuple(t).filterData}},treeCache:function(){return function(t){var e=this.treeCaches[t],i=this.treeDataTuple(t).expandedNodes.map((function(t){return t.key})),n=this.filterObj.excludeNodes,s=i.filter((function(t){return 0===n.length||!n.includes(t)}));return i.length>0?Object(o["a"])(Object(o["a"])({},e),{},{expandedKeys:s}):e}}},methods:{findTarget:function(){this.$store.dispatch("develop/expandedCurrentTreeNode")},changeFilteredExpanedTreeNodes:function(t,e){var i=e.expanded,n=e.node,s=Object(w["a"])(this.treeCaches[t].expandedKeys),o=this.filterObj.excludeNodes,a=n.dataRef.key,r=Object(w["a"])(s);if(i){var c=o.findIndex((function(t){return a===t}));-1!==c&&o.splice(c,1),r.push(a)}else{o.push(a);var l=r.findIndex((function(t){return a===t}));-1!==l&&r.splice(l,1)}this.setExpanedTreeNodes(r)},startFilter:function(){this.filterObj.value=this.filterObj.text,this.filterObj.excludeNodes=[]},ignoreEmpty:function(t){return!this.depSetting.hideEmptyFolder||!t.dic||t.children.filter((function(t){return!t.dic})).length>0},ignoreCloseJob:function(t){return!(!t.dic&&this.depSetting.hideClosedJob)||t.origin.valid},search:function(){var t=this;this.filterObj.visible=!0,this.$nextTick((function(){t.$refs.filterInput.focus()}))},menuClick:function(t,e){var i=this;"删除"===t?this.$store.dispatch("develop/deleteJobOrGroup",e).then((function(){i.$message.success("删除成功! ")})):this.$refs.createJobDialogRef.show({order:t,obj:e},(function(t,n){i.submit(t,e,n)}))},submit:function(t,e,i){var n=this;console.log(t),"新建文件夹"===t?this.createGroup({parentKey:e.key,requestData:i}).then((function(){n.$message.success("创建成功！")})):"新建任务"===t?this.createJob({parentKey:e.key,requestData:i}).then((function(){n.$message.success("创建成功！")})):"复制"===t&&this.copyJob({parentKey:e.parent,jobId:e.id,name:i.name}).then((function(){n.$message.success("复制成功! ")}))}}},Ee=$e,Ne=(i("ea21"),Object(f["a"])(Ee,Zt,te,!1,null,"04fc43c5",null)),Re=Ne.exports,Le=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t.isSelectedGroup?i("div",{staticClass:"group-container"},[t.group.configs?i("conf-editor",{attrs:{data:t.group}}):t._e()],1):i("div",{staticClass:"job-container"},[t.selectedTabNodes&&t.selectedTabNodes.length>0&&t.depSetting.showTabs?i("div",{ref:"tabs",staticClass:"tabs"},[t._l(t.selectedTabNodes,(function(e,n){return[e?i("div",{key:n,class:{tab:!0,active:t.selectedKey===e.key},on:{click:function(i){return t.click(e)},dblclick:t.doubleClick,contextmenu:function(i){return i.preventDefault(),t.rightClick(e)}}},[i("div",{class:["title"]},[i("span",{class:["icon",e.origin.runType]},[t._v(t._s(t.getTypeLabel(e)))]),i("div",[t._v(" "+t._s(e.title)+" ")]),e.origin.edited?i("a-badge",{staticClass:"edited-badge",attrs:{color:"#F5C66F"}}):t._e()],1),i("a-icon",{staticClass:"close-icon",attrs:{type:"close"},on:{click:function(i){return i.stopPropagation(),t.closeTab(e.key)}}})],1):t._e()]}))],2):i("div",{staticClass:"empty"},[t._v("没有打开任务")]),t.selectedTabNode?i("div",{style:{height:"calc(100% - "+t.tabsHeight+"px)"}},[t.job?[i("job-editor")]:i("div",{staticClass:"loading"},[t._v("正在数据加载，请稍等……")])],2):t._e()]),i("right-menu",{ref:"rightMenu"})],1)},ze=[],Ae=(i("b64b"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"main"},[t.layoutConfig.editorBottom.includes("text")?i("MonacoEditor",{staticClass:"editor",attrs:{theme:t.editorTheme,language:t.job.lang,options:{fontSize:13,automaticLayout:!0,readOnly:t.layoutConfig.editorBottom.includes("read")}},model:{value:t.job.script,callback:function(e){t.$set(t.job,"script",e)},expression:"job.script"}}):"config"===t.layoutConfig.editorBottom?[t.job.configs?i("conf-editor",{attrs:{data:t.job}}):t._e()]:"preview"===t.layoutConfig.editorBottom?[i("sql-preview",{attrs:{data:t.job},on:{preview:function(e){return t.previewJobScript({actionId:e,jobId:t.job.id})}}})]:t._e()],2),i("div",{staticClass:"footer"},[i("div",{staticClass:"tabs"},t._l(t.editorBottomTabs,(function(e){return i("div",{key:e.name,class:["tab",e.name===t.layoutConfig.editorBottom?"active":""],on:{click:function(i){return t.setEditorBottom(e.name)}}},[t._v(" "+t._s(e.label)+" ")])})),0)])])}),De=[],Ge=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"header"},[i("div",{staticStyle:{"font-weight":"500"}},[t._v("预览任务版本")]),i("h-select",{staticStyle:{width:"200px",margin:"2px 5px"},attrs:{filterable:!0,options:t.data.versions},on:{change:t.submit},model:{value:t.data.previewActionId,callback:function(e){t.$set(t.data,"previewActionId",e)},expression:"data.previewActionId"}})],1),i("div",{staticClass:"sql-container"},[i("MonacoEditor",{staticClass:"editor",attrs:{theme:t.theme,language:t.data.lang,options:{fontSize:13,readOnly:!0,automaticLayout:!0}},model:{value:t.previewScript,callback:function(e){t.previewScript=e},expression:"previewScript"}}),t.notPreview?i("div",{staticClass:"mask"},[t._v("选择后显示")]):t._e()],1)])},Je=[],Me=i("b61c"),Fe=i.n(Me),He={props:["data"],computed:{previewScript:{get:function(){return this.data.previewScript||this.data.script},set:function(){}},notPreview:function(){return!this.data.previewScript},theme:function(){return"light"===this.$store.state.setting.theme.mode?"vs":"vs-dark"}},methods:{submit:function(t){this.$emit("preview",t)}},components:{MonacoEditor:Fe.a,HSelect:O}},Pe=He,Ve=(i("251e"),Object(f["a"])(Pe,Ge,Je,!1,null,"468ab6c2",null)),qe=Ve.exports,Be=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("split-pane",{attrs:{show:[t.width,!0]},on:{resize:t.resize}},[i("MonacoEditor",{staticClass:"editor",attrs:{slot:"left",theme:t.theme,language:"ini",options:{fontSize:13,automaticLayout:!0}},slot:"left",model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),i("div",{staticClass:"right-shower",attrs:{slot:"right"},slot:"right"},[i("div",{staticClass:"ops operation-bar"},[i("a-icon",{staticClass:"refresh-icon icon",attrs:{type:"reload"},on:{click:t.refresh}}),i("a-radio-group",{attrs:{size:"small",options:t.options,"default-value":"all"},on:{change:t.changeRadio},model:{value:t.option,callback:function(e){t.option=e},expression:"option"}}),i("a-input",{staticStyle:{width:"150px"},attrs:{size:"small",placeholder:"过滤条件"},model:{value:t.filterValue,callback:function(e){t.filterValue=e},expression:"filterValue"}})],1),i("div",{staticClass:"confs"},[i("a-collapse",{attrs:{bordered:!1},model:{value:t.collapseActive,callback:function(e){t.collapseActive=e},expression:"collapseActive"}},[i("a-collapse-panel",{key:"1",attrs:{header:"当前配置"}},t._l(t.filterConfigArr,(function(e,n){return i("div",{key:n,staticClass:"conf-item"},[i("span",{staticClass:"key",on:{click:function(i){return t.copy("${"+e.key+"}")}}},[t._v(t._s(e.key))]),t._v(": "),i("span",{staticClass:"value",on:{click:function(i){return t.copy(e.value)}}},[t._v(" "+t._s(e.value)+" ")])])})),0),i("a-collapse-panel",{key:"2",attrs:{header:"继承配置"}},t._l(t.filterInheritConfigArr,(function(e,n){return i("div",{key:"herit_"+n,staticClass:"conf-item",style:{"text-decoration-line":t.configKeys.includes(e.key)?"line-through":""}},[i("span",{staticClass:"key",on:{click:function(i){return t.copy("${"+e.key+"}")}}},[t._v(t._s(e.key))]),t._v(" : "),i("span",{staticClass:"value",on:{click:function(i){return t.copy(e.value)}}},[t._v(" "+t._s(e.value)+" ")])])})),0)],1)],1)])],1)],1)},Ue=[],Ke=[{label:"所有",value:"all"},{label:"覆盖",value:"covered"},{label:"ZDT",value:"zdt"}],We="all";function Qe(t){var e=[];for(var i in t)e.push({key:i,value:t[i]});return e}var Xe={props:["data"],data:function(){return{options:Ke,option:"",filterValue:"",collapseActive:[1,2]}},created:function(){this.option=We},components:{SplitPane:Kt["a"],MonacoEditor:Fe.a},computed:{inherit:function(){return this.data.inheritConfig},text:{get:function(){return this.data.selfConfigs},set:function(t){this.data.selfConfigs=t}},width:function(){return this.$store.state.develop.layoutConfig.confEditorWidth},theme:function(){return"light"===this.$store.state.setting.theme.mode?"vs":"vs-dark"},inheritConfigArr:function(){return Qe(this.inherit)},configKeys:function(){return this.configArr.map((function(t){return t.key}))},configArr:function(){var t={};return this.text.split("\n").forEach((function(e){var i=e.split("=");if(i.length>1){var n=i[0].trim(),s=i[1].trim();t[n]=s}})),Qe(t)},filterInheritConfigArr:function(){var t=this,e=this.option,i=this.inheritConfigArr;return"covered"===e?i=i.filter((function(e){return t.configKeys.includes(e.key)})):"zdt"===e&&(i=i.filter((function(t){return t.value.includes("${zdt")}))),i.filter((function(e){return e.key.includes(t.filterValue)}))},filterConfigArr:function(){var t=this,e=this.option,i=this.configArr;if("covered"===e){var n=this.filterInheritConfigArr.map((function(t){return t.key}));i=i.filter((function(t){return n.includes(t.key)}))}else"zdt"===e&&(i=i.filter((function(t){return t.value.includes("${zdt")})));return i.filter((function(e){return e.key.includes(t.filterValue)}))}},methods:{changeRadio:function(){We=this.option},resize:function(t){this.$store.commit("develop/setConfEditorWidth",t)},copy:function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();var i=document.execCommand("copy");i&&this.$message.success("复制成功！"),document.body.removeChild(e)},refresh:function(){}}},Ye=Xe,Ze=(i("593a"),i("407c"),Object(f["a"])(Ye,Be,Ue,!1,null,"04b2bdbb",null)),ti=Ze.exports,ei={data:function(){return{test:"sdfsdfsf"}},components:{MonacoEditor:Fe.a,ConfEditor:ti,SqlPreview:qe},watch:{"job.script":function(t,e){t.id===e.id&&t!==e&&this.setJobScriptEdited({jobId:this.job.id,script:t})},"job.selfConfigs":function(t,e){}},mixins:[r],computed:{editorTheme:function(){return"light"===this.theme.mode?"vs":"vs-dark"}}},ii=ei,ni=(i("8d473"),Object(f["a"])(ii,Ae,De,!1,null,"1499b82a",null)),si=ni.exports,oi={data:function(){return{tabsHeight:0}},watch:{"selectedTabNodes.length":{handler:function(t,e){e!==t&&this.updateTabsHeight()}},"leftTab.width":{handler:function(){this.updateTabsHeight()}},"rightTab.width":{handler:function(){this.updateTabsHeight()}}},components:{ConfEditor:ti,JobEditor:si,RightMenu:ke},mixins:[r],created:function(){var t=this;setTimeout((function(){t.updateTabsHeight()}),500)},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.updateTabsHeight()}))},methods:{updateTabsHeight:function(){var t=this;this.$nextTick((function(){var e,i=null===(e=t.$refs.tabs)||void 0===e?void 0:e.offsetHeight;i&&(t.tabsHeight=i)}))},getTypeLabel:function(t){var e,i;return null!==(e=null===t||void 0===t||null===(i=t.origin.runType)||void 0===i?void 0:i.substring(0,1).toLowerCase())&&void 0!==e?e:"?"},click:function(t){this.switchSelectedTab(t.key)},doubleClick:function(){this.toggleOnlyCenter()},rightClick:function(t){var e=this,i=t.key,n=this.selectedTabKeys,s={"关闭":function(t){return e.closeTab(t)},"关闭其他":function(t){return e.closeOtherTabs(t)},"关闭右侧所有":function(t){return e.closeAllRightTabs(t)},"全部关闭":function(){return e.closeAllTabs()}},o=Object.keys(s);n.findIndex((function(t){return t===i}))+1===n.length&&o.splice(2,1),1===n.length&&o.splice(1,2),this.$refs.rightMenu.show(o,(function(t){return s[t](i)}))}}},ai=oi,ri=(i("6e1f"),Object(f["a"])(ai,Le,ze,!1,null,"5608db39",null)),ci=ri.exports,li=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t.infoData?i("attached-header",{attrs:{type:"right"},scopedSlots:t._u([{key:"header",fn:function(){return["job"===t.rightTab.name?i("a-icon",{staticClass:"icon",attrs:{type:"setting"},on:{click:t.openConfSetting}}):t._e()]},proxy:!0}],null,!1,815244705)},[i("div",{staticClass:"content"},["job"===t.rightTab.name?i("job-info",{attrs:{"is-group":t.isSelectedGroup,data:t.infoData,active:t.rightTab.name}}):"publish"===t.rightTab.name?i("job-publish",{attrs:{data:t.infoData}}):"dependency"===t.rightTab.name?[i("dependency-setting",{attrs:{jobId:t.infoData.id,edited:t.selectedTabNode.origin.edited}})]:t._e()],2)]):t._e(),i("conf-setting",{ref:"confSettingRef"})],1)},ui=[],di=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("a-collapse",{attrs:{bordered:!1},model:{value:t.collapseActive,callback:function(e){t.collapseActive=e},expression:"collapseActive"}},[i("a-collapse-panel",{key:"1",attrs:{header:"基础信息"}},[i("a-descriptions",{attrs:{column:1,size:"small"}},[i("a-descriptions-item",{attrs:{label:"ID",span:"1"}},[t._v(t._s(t.data.id)+" ")]),i("a-descriptions-item",{attrs:{label:"名称"}},[t._v(t._s(t.data.name)+" ")]),i("a-descriptions-item",{attrs:{label:"描述"}},[t._v(t._s(t.data.description)+" ")]),i("a-descriptions-item",{attrs:{label:"所有人"}},[t._v(t._s(t.data.owner)+" ")]),i("a-descriptions-item",{attrs:{label:"关注人"}},[t.data.focusUsers&&t.data.focusUsers.length>0?t._l(t.data.focusUsers,(function(e,n){return i("a-tag",{key:n},[t._v(" "+t._s(e)+" ")])})):[t._v(" 无 ")]],2),i("a-descriptions-item",{attrs:{label:"管理员"}},[t.data.adminUsers&&t.data.adminUsers.length>0?t._l(t.data.adminUsers,(function(e,n){return i("a-tag",{key:n},[t._v(" "+t._s(e)+" ")])})):[t._v(" 无 ")]],2),t.isGroup?t._e():[i("a-descriptions-item",{attrs:{label:"任务类型"}},[t._v(t._s(t.data.runType)+" ")]),i("a-descriptions-item",{attrs:{label:"调度类型"}},[t._v(t._s(["定时调度","依赖调度"][t.data.scheduleType])+" ")]),i("a-descriptions-item",{attrs:{label:"调度"}},[i("div",{staticClass:"dot-inner"},[i("a-badge",{attrs:{color:t.data.valid?"#87d068":"#f50",text:t.data.valid?"开启":"关闭"}})],1)]),i("a-descriptions-item",{attrs:{label:"机器组"}},[t._v(t._s(t.data.hostGroupName)+" ")]),i("a-descriptions-item",{attrs:{label:"区域"}},[t._v(" "+t._s(t.areas)+" ")])]],2)],1),t.isGroup?t._e():i("a-collapse-panel",{key:"2",attrs:{header:"任务配置"}},[i("a-descriptions",{attrs:{column:1,size:"small"}},[0===t.data.scheduleType?i("a-descriptions-item",{attrs:{label:"定时表达式"}},[t._v(" "+t._s(t.data.cronExpression)+" ")]):[i("a-descriptions-item",{attrs:{label:"依赖任务"}},[i("div",{on:{click:function(e){return t.copyDependency(t.data.dependencyArr)}}},t._l(t.data.dependencyArr,(function(e,n){return i("a-tag",{key:n},[t._v(" "+t._s(e)+" ")])})),1)]),i("a-descriptions-item",{attrs:{label:"依赖周期"}},[t._v(t._s(t.data.cycle)+" ")])],i("a-descriptions-item",{attrs:{label:"重复执行"}},[t._v(t._s(t.data.repeat?"是":"否")+" ")]),i("a-descriptions-item",{attrs:{label:"重试次数"}},[t._v(t._s(t.data.retryTimes)+" ")]),i("a-descriptions-item",{attrs:{label:"重试间隔（分）"}},[t._v(t._s(t.data.retryWaitTime)+" ")]),i("a-descriptions-item",{attrs:{label:"优先级"}},[t._v(t._s(t.data.priorityLevel)+" ")]),i("a-descriptions-item",{attrs:{label:"质量阻塞"}},[i("a-badge",{attrs:{color:t.data.qualityCheck?"#87d068":"#ff5500",text:t.data.qualityCheck?"开启":"关闭"}})],1)],2)],1),t.isGroup?t._e():i("a-collapse-panel",{key:"3",attrs:{header:"告警配置"}},[i("a-descriptions",{attrs:{column:1,size:"small"}},[i("a-descriptions-item",{attrs:{label:"预计结束时长（分）"}},[t._v(t._s(t.data.mustEndMinute)+" ")]),i("a-descriptions-item",{attrs:{label:"预计结束"}},[t._v(t._s(t.data.estimatedEndHour)+" ")]),i("a-descriptions-item",{attrs:{label:"告警等级"}},[t._v(t._s(t.data.alarmLevel)+" ")])],1)],1)],1)],1)},fi=[],hi=(i("a15b"),{props:["data","active","isGroup"],data:function(){return{collapseActive:[1,2,3],v:null,confirmLoading:!1}},components:{},computed:{areas:function(){var t=this;return this.$store.state.develop.areas.filter((function(e){return t.data.areaIds.includes(e.id)})).map((function(t){return t.name})).join(",")}},methods:{copyDependency:function(t){this.copy(t.join(" "))},copy:function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();var i=document.execCommand("copy");i&&this.$message.success("复制成功！"),document.body.removeChild(e)},handleClick:function(t,e){this.v=t,e.stopPropagation()},handleOk:function(){console.log("ok"),this.v=null}}}),pi=hi,mi=(i("d56f"),i("d69f"),Object(f["a"])(pi,di,fi,!1,null,"284f26fc",null)),vi=mi.exports,bi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{wrapClassName:"conf-setting-dialog",visible:t.visible,width:"36%",closable:!1,mask:!0,destroyOnClose:!0,centered:!0,footer:null},on:{cancel:t.close}},[t.infoData.id?i("div",{staticClass:"container",style:t.isGroup?"height: 30vh;":"height: 85vh;"},[t.loading?i("div",{staticClass:"loading-container"},[i("div",{staticClass:"title"},[t._v(t._s(t.loadingTitle))])]):t._e(),i("div",{staticClass:"divider-box",attrs:{title:"基础信息"}},[i("div",{staticClass:"content"},[i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v(t._s((t.isGroup?"":"任务")+"名称"))]),i("a-input",{staticStyle:{width:"240px"},attrs:{size:"small"},model:{value:t.job.name,callback:function(e){t.$set(t.job,"name",e)},expression:"job.name"}})],1),i("div",{staticClass:"form-line",staticStyle:{"align-items":"flex-start"}},[i("div",{staticClass:"title"},[t._v(t._s((t.isGroup?"":"任务")+"描述"))]),i("a-input",{staticStyle:{width:"240px"},attrs:{type:"textarea",size:"small"},model:{value:t.job.description,callback:function(e){t.$set(t.job,"description",e)},expression:"job.description"}})],1),t.isGroup?t._e():i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("机器组：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:t.hostGroups.map((function(t){return{value:t.id,label:t.name}}))},model:{value:t.job.hostGroupId,callback:function(e){t.$set(t.job,"hostGroupId",e)},expression:"job.hostGroupId"}})],1),t.isGroup?t._e():i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("区域：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{multiple:!0,options:t.areas.map((function(t){return{value:t.id,label:t.name}}))},model:{value:t.job.areaIds,callback:function(e){t.$set(t.job,"areaIds",e)},expression:"job.areaIds"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("管理员：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{filterable:!0,multiple:!0,options:t.allUser},model:{value:t.job.adminUsers,callback:function(e){t.$set(t.job,"adminUsers",e)},expression:"job.adminUsers"}})],1)])]),t.isGroup?t._e():[i("div",{staticClass:"divider-box",attrs:{title:"调度配置"}},[i("div",{staticClass:"content"},[i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("任务类型：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:["Spark","Hive","Shell","Python"]},model:{value:t.job.runType,callback:function(e){t.$set(t.job,"runType",e)},expression:"job.runType"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("调度类型：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:[{label:"定时调度",value:0},{label:"依赖调度",value:1}]},model:{value:t.job.scheduleType,callback:function(e){t.$set(t.job,"scheduleType",e)},expression:"job.scheduleType"}})],1),1===t.job.scheduleType?i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("依赖任务：")]),i("div",[t.job.useRecommend?i("h-select",{staticStyle:{width:"240px"},attrs:{multiple:!0,filterable:!0,placeholder:"",options:t.jobOptions},model:{value:t.job.recommendDependencyArr,callback:function(e){t.$set(t.job,"recommendDependencyArr",e)},expression:"job.recommendDependencyArr"}}):i("h-select",{staticStyle:{width:"240px"},attrs:{multiple:!0,filterable:!0,options:t.jobOptions},model:{value:t.job.dependencyArr,callback:function(e){t.$set(t.job,"dependencyArr",e)},expression:"job.dependencyArr"}}),i("a-checkbox",{staticStyle:{"font-size":"10px",display:"block","margin-top":"10px"},attrs:{size:"small"},on:{change:t.checkUseRecommend},model:{value:t.job.useRecommend,callback:function(e){t.$set(t.job,"useRecommend",e)},expression:"job.useRecommend"}},[t._v("使用系统推荐的依赖")])],1)]):t._e(),0===t.job.scheduleType?i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("定时表达式：")]),t._l(t.job.cronExpressionArr,(function(e,n){return[i("a-input",{key:n,staticStyle:{"font-size":"10px","margin-right":"2px",width:"38.3px"},attrs:{size:"small",disabled:0===n},model:{value:t.job.cronExpressionArr[n],callback:function(e){t.$set(t.job.cronExpressionArr,n,e)},expression:"job.cronExpressionArr[index]"}})]}))],2):t._e(),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("依赖周期：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:[{value:"NONE",label:"无"},{value:"SELF_LAST",label:"自依赖，依赖于当前任务的上一周期"}]},model:{value:t.job.dependencyPeriod,callback:function(e){t.$set(t.job,"dependencyPeriod",e)},expression:"job.dependencyPeriod"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("重复执行：")]),i("a-checkbox",{staticStyle:{"font-size":"10px"},attrs:{size:"small"},model:{value:t.job.repeat,callback:function(e){t.$set(t.job,"repeat",e)},expression:"job.repeat"}},[t._v("是否重复执行")])],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("重试次数：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:[0,1,2,3,4,6,8,144]},model:{value:t.job.retryTimes,callback:function(e){t.$set(t.job,"retryTimes",e)},expression:"job.retryTimes"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("重试间隔(分)：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:[1,10,30,60,120]},model:{value:t.job.retryWaitTime,callback:function(e){t.$set(t.job,"retryWaitTime",e)},expression:"job.retryWaitTime"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("优先级：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:["高","中","低"].map((function(t,e){return{label:t,value:e+1}}))},model:{value:t.job.priorityLevel,callback:function(e){t.$set(t.job,"priorityLevel",e)},expression:"job.priorityLevel"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("质量阻塞：")]),i("a-checkbox",{staticStyle:{"font-size":"10px"},attrs:{size:"small"},model:{value:t.job.qualityCheck,callback:function(e){t.$set(t.job,"qualityCheck",e)},expression:"job.qualityCheck"}})],1)])]),i("div",{staticClass:"divider-box",attrs:{title:"告警配置"}},[i("div",{staticClass:"content"},[i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("告警等级：")]),i("h-select",{staticStyle:{width:"240px"},attrs:{options:["邮件","微信","电话"].map((function(t,e){return{label:t,value:e}}))},model:{value:t.job.alarmLevelCode,callback:function(e){t.$set(t.job,"alarmLevelCode",e)},expression:"job.alarmLevelCode"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("预计时长：")]),i("a-input-number",{staticStyle:{"margin-right":"2px","font-size":"10px",width:"70px"},attrs:{min:0,size:"small",formatter:function(t){return t+"分钟"},parser:function(t){return t.replace("分钟","")}},model:{value:t.job.mustEndMinute,callback:function(e){t.$set(t.job,"mustEndMinute",e)},expression:"job.mustEndMinute"}})],1),i("div",{staticClass:"form-line"},[i("div",{staticClass:"title"},[t._v("预计结束：")]),i("a-input-number",{staticStyle:{"margin-right":"-1px","font-size":"10px",width:"60px"},attrs:{min:0,max:23,size:"small",placeholder:"时",formatter:function(t){return t+"时"},parser:function(t){return t.replace("时","")}},model:{value:t.job.estimatedEndHourArr[0],callback:function(e){t.$set(t.job.estimatedEndHourArr,0,e)},expression:"job.estimatedEndHourArr[0]"}}),i("a-input-number",{staticStyle:{"font-size":"10px",width:"60px"},attrs:{min:0,max:59,size:"small",placeholder:"分",formatter:function(t){return t+"分"},parser:function(t){return t.replace("分","")}},model:{value:t.job.estimatedEndHourArr[1],callback:function(e){t.$set(t.job.estimatedEndHourArr,1,e)},expression:"job.estimatedEndHourArr[1]"}})],1)])])],i("div",{staticStyle:{width:"100%",height:"30px"}},[i("div",{staticClass:"button active",staticStyle:{float:"right"},on:{click:t.submit}},[t._v(" 确认 ")]),i("div",{staticClass:"button",staticStyle:{float:"right"},on:{click:t.close}},[t._v("取消")])])],2):t._e()])},gi=[],yi=(i("6062"),i("3ca3"),i("ddb0"),i("a630"),i("b775"));function _i(t){return yi["a"].post("/scheduleCenter/dependentInAndOutTables?jobId=".concat(t),{})}function Ci(t){return yi["a"].post("/scheduleCenter/parseDependentInAndOutTables?jobId=".concat(t),{})}function xi(t){var e=t.inTables,i=t.jobId;return yi["a"].post("/scheduleCenter/recommendDependentJobs?inTables=".concat(e||"","&jobId=").concat(i),{})}var ki={data:function(){return{infoData:{},infoDataBackup:{},isGroup:null,visible:!1,callback:null,allUser:[],loading:!1,loadingTitle:"保存中……",jobList:[]}},components:{HSelect:O},computed:{job:function(){return this.infoData},areas:function(){return this.$store.state.develop.areas},hostGroups:function(){return this.$store.state.develop.hostGroups},allJobs:function(){return this.$store.getters["develop/allJobs"]},jobOptions:function(){return this.jobList.map((function(t){return{value:t.id,label:"".concat(t.name,"(").concat(t.id,")")}}))}},methods:{checkUseRecommend:function(t){var e=this,i=t.target.checked;i&&(this.isGroup||xi({jobId:this.infoData.id}).then((function(t){var i=new Set;t.forEach((function(t){return t.jobs.forEach((function(t){return i.add(t)}))}));var n=Array.from(i).sort();e.infoData.recommendDependencyArr=n,0==n.length&&(e.$message.warn("系统没有找到依赖建议，请自行配置依赖"),setTimeout((function(){e.infoData.useRecommend=!1}),200))})))},show:function(t,e){var i=this,n=t.infoData,s=t.isGroup;this.infoData=n,this.isGroup=s,this.infoData=JSON.parse(JSON.stringify(n)),this.infoDataBackup=JSON.parse(JSON.stringify(n)),this.callback=e,this.visible=!0,Object(b["l"])(n.id,s).then((function(t){return i.allUser=t})),Object(b["u"])().then((function(t){return i.jobList=t}))},close:function(){this.visible=!1,this.infoData=this.infoDataBackup},submit:function(){var t=this,e=Object(o["a"])({},this.infoData);e.justInfo=!0,this.loading=!0,this.loadingTitle="保存中……",setTimeout((function(){t.loadingTitle="保存中，比较慢，请稍等……"}),5e3),setTimeout((function(){t.loadingTitle="保存中……但是这也太慢了，再等等吧马上好了……"}),1e4),this.$store.dispatch("develop/update".concat(this.isGroup?"Group":"Job"),{id:e.id,data:e,refresh:!1}).then((function(){t.loading=!1,t.visible=!1,t.callback(t.infoData)}))}}},wi=ki,ji=(i("3422"),i("6fa9"),Object(f["a"])(wi,bi,gi,!1,null,"28a5e476",null)),Ti=ji.exports,Ii=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t.data.publishes&&t.data.publishes.length>0?i("div",{staticClass:"publish-list"},t._l(t.data.publishes,(function(e,n){return i("div",{key:n,staticClass:"publish-item"},[e.current?i("span",{staticStyle:{"background-color":"#87d068","font-size":"5px",color:"#fff",padding:"2px 4px"}},[t._v("最新发布")]):t._e(),t._v(" "+t._s(e.description)+" "),i("a-tag",[t._v(t._s(e.username))]),i("a-badge",{attrs:{color:e.stateInfo.color,text:e.stateInfo.text}}),i("div",{staticClass:"time"},[t._v(t._s(t.parseTime(e.gmtCreate)))]),i("div",{staticClass:"link-list"},[i("a",{staticClass:"link",on:{click:function(i){return t.codeCompare(e)}}},[t._v("对比当前")]),i("a",{staticClass:"link",attrs:{disabled:e.current||!e.lastVersion||!t.lastestPublish&&t.lastestPublish},on:{click:function(i){return t.lastestCodeCompare(e)}}},[t._v("对比发布")]),"padding"===e.state?i("a",{staticClass:"link",staticStyle:{"margin-left":"5px"},on:{click:function(i){return t.cancel(e)}}},[t._v("取消")]):t._e()])],1)})),0):i("div",{staticStyle:{"text-align":"center","padding-top":"20px"}},[t._v("没有发布")]),i("code-compare",{ref:"codeCompareRef"})],1)},Si=[],Oi=i("c466");function $i(t,e){return{script:t.script,selfConfigs:t.selfConfigs,description:e||"["+t.description+"] "+Object(Oi["a"])(t.gmtCreate)}}var Ei={props:["data"],data:function(){return{}},components:{CodeCompare:ft["a"]},computed:{lastestPublish:function(){return this.data.publishes.find((function(t){return t.current}))}},methods:{parseTime:Oi["a"],codeCompare:function(t){this.$refs.codeCompareRef.show(t.jobRunType,$i(t),$i(this.data,"现在的代码"))},lastestCodeCompare:function(t){this.$refs.codeCompareRef.show(t.jobRunType,$i(this.lastestPublish||t.lastVersion),$i(t))},cancel:function(t){var e=this;this.$store.dispatch("develop/cancelJobPublish",{pubId:t.id,jobId:t.jobId}).then((function(){e.$message.success("取消成功!")}))}}},Ni=Ei,Ri=(i("8717"),Object(f["a"])(Ni,Ii,Si,!1,null,"674e5559",null)),Li=Ri.exports,zi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dep-setting-container"},[i("div",{staticStyle:{"margin-bottom":"8px","font-size":"14px"}},[t._v(" 原依赖图查看请点击工具栏"),i("my-icon",{staticStyle:{margin:"0 8px","font-size":"16px"},attrs:{type:"hera_icon_dependency"}}),t._v("图标 ")],1),i("lineage-table",{attrs:{title:"当前配置上下游输入输出","in-tables":t.dependentInfo.inTables,"out-tables":t.dependentInfo.outTables}}),i("div",{staticStyle:{"margin-top":"10px"}},[i("a-button",{staticStyle:{"margin-bottom":"10px"},attrs:{size:"small"},on:{click:t.parseScript2Dep}},[t._v("解析输入输出")]),t.autoParseInfo?i("div",[i("lineage-table",{attrs:{title:"解析结果","in-tables":t.autoParseInfo.inTables,"out-tables":t.autoParseInfo.outTables}})],1):t._e(),t.inTables.length>0?i("div",{staticStyle:{"margin-top":"10px"}},[i("a-button",{staticStyle:{"margin-bottom":"10px"},attrs:{size:"small"},on:{click:t.recommendDepJobs}},[t._v("推荐依赖任务")]),i("a-table",{attrs:{size:"small",pagination:!1,columns:[{title:"库表",dataIndex:"tableName"},{title:"任务",dataIndex:"jobs",customRender:function(t){return t.join(",")}}],"data-source":t.recommendDeps}})],1):t._e()],1)],1)},Ai=[],Di=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dep-table"},[i("div",{staticStyle:{"align-items":"center","margin-bottom":"10px"}},[i("div",{staticClass:"title"},[t._v(t._s(t.title))]),i("a-radio-group",{staticClass:"radio",attrs:{"default-value":"list","button-style":"solid",size:"small"},model:{value:t.inOrOut,callback:function(e){t.inOrOut=e},expression:"inOrOut"}},[i("a-radio-button",{attrs:{value:!0}},[t._v(" 输入表 ")]),i("a-radio-button",{attrs:{value:!1}},[t._v(" 输出表 ")])],1)],1),i("div",{staticClass:"table"},[t.tables.length>0?i("a-table",{attrs:{size:"small",pagination:!1,columns:t.columns,"data-source":t.tables}}):i("div",{staticStyle:{"font-size":"13px"}},[t._v(" 没有"+t._s(t.inOrOut?"输入":"输出")+" ")])],1)])},Gi=[],Ji=[{dataIndex:"name",title:"库表名"},{title:"录入类型",key:"auto",customRender:function(t,e){return e.auto?"自动解析":"手动录入"}},{title:"时间",key:"time",customRender:function(t,e){return Object(Oi["a"])(e.time)}}],Mi={props:{title:{type:String},inTables:{type:Array},outTables:{type:Array}},data:function(){return{inOrOut:!0,columns:Ji}},computed:{tables:function(){return this.inOrOut?this.inTables:this.outTables}}},Fi=Mi,Hi=(i("e246"),Object(f["a"])(Fi,Di,Gi,!1,null,null,null)),Pi=Hi.exports,Vi={data:function(){return{dependentInfo:{inTables:[],outTables:[]},autoParseInfo:null,addedDentInfo:{inTables:[],outTables:[]},recommendDeps:[]}},props:{jobId:{type:Number},edited:{type:Boolean}},components:{LineageTable:Pi},computed:{inTables:function(){var t,e=(null===(t=this.autoParseInfo)||void 0===t?void 0:t.inTables)||[];return e=e.concat(this.addedDentInfo.inTables),e}},created:function(){var t=this;_i(this.jobId).then((function(e){t.dependentInfo=e}))},methods:{recommendDepJobs:function(){var t=this,e=this.inTables.map((function(t){return t.name})).join(",");xi({inTables:e}).then((function(e){t.recommendDeps=e}))},parseScript2Dep:function(){var t=this;this.edited?this.$message.warn("解析之前先保存!"):Ci(this.jobId).then((function(e){t.autoParseInfo=e})).catch((function(){}))}}},qi=Vi,Bi=(i("39ee"),Object(f["a"])(qi,zi,Ai,!1,null,null,null)),Ui=Bi.exports,Ki={mixins:[r],components:{AttachedHeader:pe,JobInfo:vi,ConfSetting:Ti,JobPublish:Li,DependencySetting:Ui},computed:{infoData:function(){return this.isSelectedGroup?this.group:this.job}},methods:{openConfSetting:function(){var t=this;this.$refs.confSettingRef.show({infoData:this.infoData,isGroup:this.isSelectedGroup},(function(e){Object.assign(t.infoData,e),t.$message.success("更新成功！")}))}}},Wi=Ki,Qi=(i("d6cc"),Object(f["a"])(Wi,li,ui,!1,null,"5eec39a2",null)),Xi=Qi.exports,Yi=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("attached-header",{attrs:{type:"bottom"}},["log"===t.bottomTab.name?i("job-log-container"):t._e(),"opLog"===t.bottomTab.name?i("job-op-record-container"):t._e()],1)],1)},Zi=[],tn=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSelectedGroup,expression:"!isSelectedGroup"}],staticClass:"log-container"},[i("div",{staticClass:"button-list operation-bar"},[t.logRecord&&t.logRecord.current?[i("my-icon",{class:["icon","refresh"],attrs:{type:"hera_icon_refresh"},on:{click:t.refreshLogs}}),i("my-icon",{class:["icon","stop","running"!==t.currentLogItem.status?"disabled":""],attrs:{type:"hera_icon_stop"},on:{click:function(e){return t.cancelJob({jobId:t.logRecord.jobId,logItemId:t.currentLogItem.id})}}})]:t._e()],2),t.logRecord?i("div",{staticClass:"log-main"},[i("split-pane",{attrs:{show:[t.width,!0]},on:{resize:t.resize}},[i("div",{staticClass:"main",attrs:{slot:"left"},slot:"left"},[i("div",{staticClass:"header"}),i("div",{staticClass:"content log-list"},[t._l(t.logRecord.list,(function(e,n){return i("div",{key:n,class:["log-item",t.realCurrentLogItemId===e.id?"active":""],on:{click:function(i){t.logRecord.current=e.id,t.countdown(e.id)}}},[i("span",{staticStyle:{"font-weight":"600","margin-right":"10px"}},[t._v(t._s(e.actionId))]),t._v(" "+t._s(e.operator)+t._s(e.triggerType)+" "),i("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.illustrate))]),i("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.operator))]),i("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.durations))]),i("div",{class:["status",e.status]},[i("my-icon",{staticClass:"icon",attrs:{type:"hera_icon_"+{failed:"error",success:"yes1",running:"loading"}[e.status]}}),i("span",{staticClass:"text"},[t._v(t._s({failed:"ERROR",success:"SUCCESS",running:"RUNNING",wait:"WAIT"}[e.status]))])],1)])})),!t.logRecord.loadedAll&&t.logRecord.list&&t.logRecord.list.length>0?i("div",{staticClass:"see-more",on:{click:t.loadMoreLogs}},[t._v(" 查看更多 ")]):i("div",{staticClass:"loaded-all"},[t._v("全部加载完毕")])],2)]),i("div",{staticClass:"main",attrs:{slot:"right"},slot:"right"},[i("div",{staticClass:"header log-header"},[t.currentLogItem.id?[i("div",{staticClass:"left"},[i("div",{class:["status",t.currentLogItem.status],on:{dblclick:function(e){return t.qualityCheckPassClick(t.currentLogItem)}}},[i("my-icon",{staticClass:"icon",attrs:{type:"hera_icon_"+{failed:"error",success:"yes1",running:"loading"}[t.currentLogItem.status]}}),i("span",{staticClass:"text"},[t._v(t._s({failed:"运行失败",success:"运行成功",running:"运行中",wait:"待执行"}[t.currentLogItem.status]))])],1),i("div",{staticClass:"info"},[i("span",{staticStyle:{"font-size":"11px"}},[t._v(" 【"+t._s(t.currentLogItem.triggerType)+"】 ")]),t._v(" "+t._s(t.currentLogItem.startTime)+" - "+t._s(t.currentLogItem.endTime)+" - "+t._s(t.currentLogItem.durations)+" "),i("span",{staticClass:"executeHost"},[t._v(" 执行机器: "),i("span",{staticClass:"text",on:{click:function(e){return t.copy(t.currentLogItem.executeHost)}}},[t._v(t._s(t.currentLogItem.executeHost))])]),"running"!==t.currentLogItem.status?i("a-switch",{staticStyle:{"margin-left":"2px"},attrs:{size:"small","checked-children":"关键日志","un-checked-children":"普通日志",checked:t.checked},on:{change:t.important}}):t._e()],1)]),i("div",{staticClass:"right operation-bar"},[i("router-link",{staticClass:"text",staticStyle:{"font-size":"10px"},attrs:{target:"_blank",to:{path:"/log",query:{id:t.currentLogItem.id,jobId:t.currentLogItem.jobId}}}},[t._v(" 全部日志 ")])],1)]:t._e()],2),t.currentLogItem.id?i("div",{staticClass:"content log-text",attrs:{id:"scrollArea"}},[i("div",{attrs:{id:"contentArea"}}),t.spinning?i("div",[i("a-icon",{staticStyle:{"margin-right":"10px"},attrs:{type:"loading"}}),t._v("日志加载中…… ")],1):t._e()]):t._e()])])],1):t._e(),i("a-modal",{attrs:{wrapClassName:"full-log-dialog",visible:t.visible,width:"80%",closable:!1,mask:!0,destroyOnClose:!0,footer:null},on:{cancel:function(e){t.visible=!1}}},[i("div",{staticStyle:{height:"80vh",position:"relative",overflow:"hidden"}},[i("p",{ref:"logTextRef",staticClass:"log-text",domProps:{innerHTML:t._s(void 0!==t.currentLogItem.headLog?t.logHead+t.currentLogItem.headLog+t.currentLogItem.log:t.logHead)}})])])],1)},en=[];function nn(t){return yi["a"].get("/job/forceStop?historyId=".concat(t))}var sn=i("ba51"),on=i.n(sn),an={data:function(){return{logs:[],currentLogItemId:null,visible:!1,checked:!1,spinning:!1,countdownMap:{},data:[],clusterize:null,timeoutTask:null,logHead:'<div style="font-weight: bold;display:flex;">日志提示：\n           <span class="error"  style="margin-right: 10px">错误日志</span>\n           <span class="hera" style="margin-right: 10px">赫拉日志</span>\n           <span class="console" >控制台日志</span>\n        </div><br>'}},components:{SplitPane:Kt["a"]},mixins:[r],watch:{realCurrentLogItemId:function(t,e){var i=this;t&&(this.destroyTimeoutTask(),this.currentLogItem.position=0,this.spinning=!0,this.$nextTick((function(){var n;t!==e&&(i.checked=!1,i.clusterize&&(i.clusterize.update([]),i.data=[])),i.getLog(t,null===(n=i.logRecord)||void 0===n?void 0:n.jobId)})))}},computed:{width:function(){return this.layoutConfig.logContainerWidth},realCurrentLogItemId:function(){var t;return(null===(t=this.logRecord)||void 0===t?void 0:t.current)||this.currentLogItemId},currentLogItem:function(){var t,e,i=this;return(null===(t=this.logRecord)||void 0===t||null===(e=t.list)||void 0===e?void 0:e.find((function(t){return t.id===i.realCurrentLogItemId})))||{}}},created:function(){},destroyed:function(){this.destroyTimeoutTask()},methods:{destroyTimeoutTask:function(){clearTimeout(this.timeoutTask),this.timeoutTask=null},destroyClusterize:function(){this.clusterize&&(this.clusterize.destroy(!0),this.clusterize=null)},important:function(t){this.checked=t,t?this.clusterize.update(this.data.filter((function(t){return t.includes("important")}))):this.clusterize.update(this.data)},initClusterize:function(){this.destroyClusterize(),this.clusterize=new on.a({rows:this.data,scrollId:"scrollArea",contentId:"contentArea",rows_in_block:50,blocks_in_cluster:10,no_data_text:""})},countdown:function(t){var e=this,i=(new Date).getTime();this.countdownMap[t]||(this.countdownMap[t]=[]);var n=this.countdownMap[t];i-n[n.length-1]<1e3||0===n.length?n.push(i):n.length=0;var s=15-n.length;s<=10&&s>0&&this.$message.warn("点击".concat(s,"下后")),0===s&&(n.length=0,nn(t).then((function(){e.$message.success("置为失败! ")})))},refreshLogs:function(){var t=this;this.currentLogItemId=this.logRecord.current,this.$store.dispatch("develop/getJobLogList",{pageSize:this.logRecord.pageSize,offset:0,jobId:this.logRecord.jobId}).then((function(){t.logRecord.current=t.currentLogItemId,t.currentLogItem&&t.getLog(t.currentLogItem.id,t.logRecord.jobId),t.currentLogItemId=null,t.$message.success("刷新成功! ")}))},getLog:function(t,e){var i=this,n=this.currentLogItem,s=-1;return"running"===n.status&&(s=n.position||0),this.$store.dispatch("develop/getLogContent",{jobId:e,logItemId:t,position:s}).then((function(){var t,e,n=i.currentLogItem,o=(null===(t=n.headLog)||void 0===t?void 0:t.split("<br>"))||[],a=(null===(e=n.log)||void 0===e?void 0:e.split("<br>"))||[];"running"===n.status?(s<=0&&(i.initClusterize(),i.clusterize.append(i.logHead),i.clusterize.append(o)),i.clusterize.append(a),i.timeoutTask=setTimeout((function(){i.getLog(n.id,n.jobId)}),5e3)):(i.data=[].concat(Object(w["a"])(o),Object(w["a"])(a)),i.initClusterize()),i.clusterize.refresh(),i.spinning=!1}))},resize:function(t){this.setLogContainerWidth(t)},loadMoreLogs:function(){var t=this.logRecord.jobId,e=this.logRecord.offset+this.logRecord.pageSize;this.$store.dispatch("develop/getJobLogList",{pageSize:this.logRecord.pageSize,offset:e,jobId:t})},qualityCheckPassClick:function(t){var e=this;Object(b["z"])({actionId:t.actionId}).then((function(t){t?e.$message.success("广播成功"):e.$message.error("广播失败")}))},copy:function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();var i=document.execCommand("copy");i&&this.$message.success("复制成功！"),document.body.removeChild(e)}}},rn=an,cn=(i("1449"),i("89cc"),Object(f["a"])(rn,tn,en,!1,null,"d1062c4a",null)),ln=cn.exports,un=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t.jobOpRecord?[i("div",{staticClass:"record-list"},t._l(t.jobOpRecord.list,(function(e,n){return i("div",{key:n,staticClass:"record-item"},[i("span",{staticStyle:{"margin-right":"30px"}},[t._v(t._s(e.createTime))]),i("span",{staticStyle:{"font-weight":"600","min-width":"170px",display:"inline-block"}},[t._v(t._s(e.sso+"("+e.gname+")"))]),t.isLink(e.type)?i("a",{on:{click:function(i){return t.getRecordDetail(e)}}},[t._v(t._s(e.type)+" "),"更新脚本内容"!==e.type?i("a-icon",{attrs:{type:e.changeObj&&e.visible?"down":"up"}}):t._e()],1):i("span",[t._v(" "+t._s(e.type))]),e.changeObj?["更新脚本内容"!==e.type?i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"record.visible"}],staticClass:"change-content"},[t._v(" "+t._s(e.changeObj.oldVal)+" "),i("span",{staticStyle:{margin:"0 10px"}},t._l([1,2,3,4],(function(t){return i("a-icon",{key:t,attrs:{type:"right"}})})),1),t._v(" "+t._s(e.changeObj.newVal)+" ")]):t._e()]:t._e()],2)})),0),t.jobOpRecord.loadedAll?i("div",[t._v("全部加载完毕")]):i("a",{on:{click:t.more}},[t._v("查看更多")]),t.compareObj?i("a-modal",{attrs:{wrapClassName:"dialog",visible:t.visible,width:"80%",closable:!1,mask:!0,destroyOnClose:!0,footer:null},on:{cancel:function(){t.visible=!1}}},[i("code-compare",{staticClass:"compare-container",staticStyle:{height:"60vh"},attrs:{origin:t.compareObj.origin,now:t.compareObj.now,theme:t.theme,lang:t.job.lang}})],1):t._e()]:t._e()],2)},dn=[],fn=i("1749");function hn(t){return Object.keys(pn).includes(t)}var pn={"任务配置":"selfConfigs","定时表达式":"cronExpression","任务开启/关闭状态":"auto","更新脚本内容":"script"},mn={mixins:[r],data:function(){return{visible:!1,compareObj:null}},computed:{theme:function(){return"light"===this.$store.state.setting.theme.mode?"vs":"vs-dark"}},components:{CodeCompare:fn["a"]},methods:{isLink:hn,more:function(){this.$store.dispatch("develop/getJobRecords",{pageSize:this.jobOpRecord.pageSize,offset:this.jobOpRecord.offset+this.jobOpRecord.pageSize,jobId:this.job.id})},getRecordDetail:function(t){var e=this;if(t.changeObj)this.setChangeVisible(t);else{var i=t.type;Object(b["m"])({id:t.logId,type:i}).then((function(i){var n={oldVal:t.content,newVal:i.content};e.$set(t,"changeObj",n),e.setChangeVisible(t)}))}},setChangeVisible:function(t){this.$set(t,"visible",!t.visible),"更新脚本内容"===t.type&&(this.compareObj={origin:{description:"",content:t.changeObj.oldVal},now:{description:"",content:t.changeObj.newVal}},this.visible=!0)}}},vn=mn,bn=(i("af5f"),Object(f["a"])(vn,un,dn,!1,null,"09a056b6",null)),gn=bn.exports,yn={mixins:[r],components:{AttachedHeader:pe,JobLogContainer:ln,JobOpRecordContainer:gn}},_n=yn,Cn=(i("52c1"),Object(f["a"])(_n,Yi,Zi,!1,null,"e61b3c68",null)),xn=Cn.exports,kn={mixins:[r],data:function(){return{loading:!1,timeout:null}},components:{MainHeader:Jt,MainFooter:qt,MainCenter:Yt,ContentLeft:Re,ContentCenter:ci,RightAttached:Xi,FooterAttached:xn,Tabs:p},destroyed:function(){this.clearTimeOut()},created:function(){var t=this;this.loading=!0,this.timeout=setTimeout((function(){t.$message.error("网络慢请求超时，请刷新页面!")}),3e4),this.restoreLayout(),this.initJobs().then((function(){t.restoreLocal();var e=t.$route.query.jobId||t.$route.params.jobId;e&&!isNaN(e)&&0!==Number(e)&&t.$store.dispatch("develop/linkSelecteNode",Number(e)).then((function(){t.$message.success("已成功跳转至任务[".concat(e,"]"))})).catch((function(e){return t.$message.error(e)})),t.loading=!1,t.clearTimeOut()}))},computed:{},methods:{clearTimeOut:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}},wn=kn,jn=(i("ea60"),i("1a76"),Object(f["a"])(wn,n,s,!1,null,"1f6d6554",null));e["default"]=jn.exports},be85:function(t,e,i){"use strict";i("07cd")},c022:function(t,e,i){},c56d:function(t,e,i){"use strict";i("209e")},c59e:function(t,e,i){},cb88:function(t,e,i){},d1a3:function(t,e,i){},d56f:function(t,e,i){"use strict";i("4327")},d69f:function(t,e,i){"use strict";i("687e")},d6cc:function(t,e,i){"use strict";i("85f7")},df6a:function(t,e,i){"use strict";i("3744")},e105:function(t,e,i){},e246:function(t,e,i){"use strict";i("26ba")},e277:function(t,e,i){"use strict";i("43d7")},e2b9:function(t,e,i){"use strict";i("c59e")},e617:function(t,e,i){},e7de:function(t,e,i){},ea21:function(t,e,i){"use strict";i("e105")},ea60:function(t,e,i){"use strict";i("aecb")},eb58:function(t,e,i){"use strict";i("c022")},ee21:function(t,e,i){},f04a:function(t,e,i){},f183:function(t,e,i){var n=i("d012"),s=i("861d"),o=i("5135"),a=i("9bf2").f,r=i("90e3"),c=i("bb2f"),l=r("meta"),u=0,d=Object.isExtensible||function(){return!0},f=function(t){a(t,l,{value:{objectID:"O"+ ++u,weakData:{}}})},h=function(t,e){if(!s(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,l)){if(!d(t))return"F";if(!e)return"E";f(t)}return t[l].objectID},p=function(t,e){if(!o(t,l)){if(!d(t))return!0;if(!e)return!1;f(t)}return t[l].weakData},m=function(t){return c&&v.REQUIRED&&d(t)&&!o(t,l)&&f(t),t},v=t.exports={REQUIRED:!1,fastKey:h,getWeakData:p,onFreeze:m};n[l]=!0},f4a9:function(t,e,i){},f4b6:function(t,e,i){},f4f3:function(t,e,i){},f613:function(t,e,i){},fcb3:function(t,e,i){"use strict";i("e7de")}}]);