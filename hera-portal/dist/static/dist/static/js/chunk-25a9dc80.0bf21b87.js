(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25a9dc80"],{"12c7":function(t,e,a){},"17bc":function(t,e,a){},4208:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("h-menu",{staticClass:"tabs",attrs:{tabs:t.tabs},on:{change:t.changeMenu},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}}),a("div",{staticClass:"main-content"},["publish"===t.tabActive?a("publish"):"user"===t.tabActive?a("user"):"recovery_approval"===t.tabActive?a("recovery"):"secretKey"===t.tabActive?a("secret-key"):"rerun"===t.tabActive?a("rerun"):"detail"===t.tabActive?a("detail"):"log"===t.tabActive?a("log"):[t._v(" 待开发 ")]],2)],1)},i=[],o=(a("159b"),a("caad"),a("2532"),a("b0c0"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"20px"}},[a("h2",[t._v(" 旧版调度中心地址 "),a("h5",{staticStyle:{"margin-top":"5px"}},[t._v(t._s(t.countDownLabel)+"后失效")])]),""!==t.key?[a("a",{staticStyle:{"font-size":"25px"},attrs:{href:t.link,target:"_blank"}},[t._v(t._s(t.link))]),a("div",{staticStyle:{"margin-top":"20px"}},[a("a-button",{attrs:{type:"primary",size:"small"},on:{click:t.refreshKey}},[t._v("立即刷新")]),a("a-button",{staticStyle:{margin:"0 20px"},attrs:{size:"small"},on:{click:function(e){return t.copy(t.link)}}},[t._v("复制到剪贴板")]),a("a-input-number",{attrs:{size:"small",min:1,max:60},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),a("a-button",{staticStyle:{"margin-left":"-1px"},attrs:{size:"small"},on:{click:function(e){return t.resetCache()}}},[t._v("设置")])],1)]:a("h5",{staticStyle:{"margin-top":"5px"}},[t._v("没有权限")])],2)}),r=[],l=(a("99af"),a("b775")),s={data:function(){return{key:"",duration:0,createTime:0,countDownInterval:null,countDownLabel:"",value:0}},computed:{link:function(){var t=window.location.host;return"https://".concat(t,"/scheduleCenter?key=").concat(this.key)}},created:function(){this.countDown(),this.refreshKey()},destroyed:function(){this.clearCountDown()},methods:{countDown:function(){var t=this;this.countDownInterval=setInterval((function(){console.log(t.createTime);var e=t.createTime/1e3+60*t.duration,a=parseInt(Date.parse(new Date)/1e3),n=parseInt(e-a),i=Math.floor(n/60%60),o=Math.floor(n%60);t.countDownLabel="".concat(i,"分").concat(o,"秒"),n<=0&&(t.countDownLabel="",t.refreshKey())}),1e3)},clearCountDown:function(){clearInterval(this.countDownInterval),this.countDownLabel="",this.countDownInterval=null},refreshKey:function(){var t=this;l["a"].get("/key").then((function(e){t.key=e.key,t.duration=e.duration,t.value=t.duration,t.createTime=e.createTime}))},resetCache:function(){var t=this;l["a"].post("/resetCache?duration=".concat(this.value)).then((function(){t.$message.success("设置成功! "),t.refreshKey()}))},copy:function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();var a=document.execCommand("copy");a&&this.$message.success("复制成功！"),document.body.removeChild(e)}}},c=s,u=a("2877"),d=Object(u["a"])(c,o,r,!1,null,null,null),f=d.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"publish-container"},[a("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center"}},[a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.stateOptions},on:{change:t.init},model:{value:t.filter.state,callback:function(e){t.$set(t.filter,"state",e)},expression:"filter.state"}}),a("a-input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{size:"small",placeholder:"任务ID"},on:{pressEnter:t.init},model:{value:t.filter.jobId,callback:function(e){t.$set(t.filter,"jobId",e)},expression:"filter.jobId"}}),a("a-radio-group",{on:{change:t.init},model:{value:t.filter.mode,callback:function(e){t.$set(t.filter,"mode",e)},expression:"filter.mode"}},[a("a-radio",{attrs:{value:"auditor"}},[t._v("审核")]),a("a-radio",{attrs:{value:"application"}},[t._v("申请")])],1)],1),a("a-table",{staticStyle:{height:"100%"},attrs:{ellipsis:!0,size:"small",columns:t.columns,"data-source":t.publishes,pagination:t.pagination,loading:t.loading,rowKey:"id"},on:{change:t.changePagination},scopedSlots:t._u([{key:"description",fn:function(e,n){return a("div",{},[n.current?a("span",{staticStyle:{"background-color":"#87d068","font-size":"5px",color:"#fff",padding:"2px 4px"}},[t._v("最新发布")]):t._e(),t._v(" "+t._s(e)+" ")])}},{key:"name",fn:function(e){return a("div",{staticStyle:{position:"relative"}},[a("a",{on:{click:function(a){return t.$router.push({name:"任务开发",params:{jobId:e.jobId}})}}},[t._v(t._s(e.jobName)+"("+t._s(e.jobId)+")")])])}},{key:"lastVersion",fn:function(e){return a("div",{},[e.lastVersion?[a("a-tag",[t._v(t._s(e.lastVersion.description))])]:e.current?[t._v(" - ")]:[t._v(" 无 ")]],2)}},{key:"stateInfo",fn:function(t){return a("div",{},[a("a-badge",{attrs:{color:t.color,text:t.text}})],1)}},{key:"action",fn:function(e){return a("div",{},[a("a",{attrs:{disabled:!e.lastVersion},on:{click:function(a){return t.compare(e)}}},[t._v("代码对比")]),"padding"===e.state&&"auditor"===t.filter.mode?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.pass(e)}}},[t._v("通过")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.reject(e)}}},[t._v("拒绝")])]:"error"===e.state?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.retry(e)}}},[t._v("重试")])]:t._e(),"padding"===e.state&&"application"===t.filter.mode?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.cancel(e)}}},[t._v("取消")])]:t._e(),"success"===e.state&&e.current&&0!==e.last?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.rollback(e)}}},[t._v("回滚")])]:t._e()],2)}}])}),a("code-compare",{ref:"codeCompareRef"})],1)},m=[],h=a("5530"),g=(a("a4d3"),a("e01a"),a("4de4"),a("10f8")),b=a("c466"),v=a("8656"),x=[{value:"padding",label:"待审批"},{value:"success",label:"成功"},{value:"cancelled",label:"已取消"},{value:"rejected",label:"已拒绝"},{value:"error",label:"失败"},{value:"rolledBack",label:"已回滚"},{value:"",label:"所有状态"}],y=[{dataIndex:"description",title:"发布描述",scopedSlots:{customRender:"description"}},{title:"任务名",key:"jobTitle",scopedSlots:{customRender:"name"}},{key:"lastVersion",title:"线上",scopedSlots:{customRender:"lastVersion"}},{title:"状态",dataIndex:"stateInfo",scopedSlots:{customRender:"stateInfo"}},{dataIndex:"username",title:"申请人"},{dataIndex:"auditorName",title:"审核人"},{title:"创建时间",dataIndex:"gmtCreate",customRender:function(t){return Object(b["a"])(t)}},{title:"操作时间",dataIndex:"opTime",customRender:function(t){return 0===t?"-":Object(b["a"])(t)}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}];function I(t,e){return{script:t.script,selfConfigs:t.selfConfigs,description:e||"["+t.description+"] "+Object(b["a"])(t.gmtCreate)}}var _={data:function(){return{stateOptions:x,columns:y,publishes:[],loading:!1,pagination:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:15},filter:{mode:"auditor",state:"padding",jobId:""}}},components:{CodeCompare:g["a"]},created:function(){this.init()},methods:{init:function(){var t=this;this.loading=!0,Object(v["e"])(this.pagination.pageSize,this.pagination.current,Object(h["a"])(Object(h["a"])({},this.filter),{},{state:""===this.filter.state?null:this.filter.state})).then((function(e){t.pagination={current:e.pageNum,pageSize:e.pageSize,total:e.total},t.publishes=e.list,t.loading=!1}))},compare:function(t){this.$refs.codeCompareRef.show(t.jobRunType,I(t.lastVersion),I(t))},pass:function(t){var e=this;Object(v["g"])(t.id).then((function(){e.$message.success("通过成功!"),e.init()}))},retry:function(t){var e=this;Object(v["i"])(t.id).then((function(){e.$message.success("重试成功!"),e.init()}))},cancel:function(t){var e=this;Object(v["a"])(t.id).then((function(){e.$message.success("取消成功!"),e.init()}))},reject:function(t){var e=this;Object(v["h"])(t.id).then((function(){e.$message.success("拒绝成功!"),e.init()}))},rollback:function(t){var e=this;Object(v["j"])(t.id).then((function(){e.$message.success("回滚成功!"),e.init()}))},changePagination:function(t){this.pagination=Object(h["a"])({},t),this.init()}}},k=_,j=(a("bb29"),Object(u["a"])(k,p,m,!1,null,"00285ce8",null)),S=j.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"publish-container"},[a("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center"}},[a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.stateOptions},on:{change:t.init},model:{value:t.filter.state,callback:function(e){t.$set(t.filter,"state",e)},expression:"filter.state"}}),a("a-input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{size:"small",placeholder:"任务ID"},on:{pressEnter:t.init},model:{value:t.filter.jobId,callback:function(e){t.$set(t.filter,"jobId",e)},expression:"filter.jobId"}}),a("a-radio-group",{on:{change:t.init},model:{value:t.filter.mode,callback:function(e){t.$set(t.filter,"mode",e)},expression:"filter.mode"}},[a("a-radio",{attrs:{value:"auditor"}},[t._v("审核")]),a("a-radio",{attrs:{value:"application"}},[t._v("申请")])],1)],1),a("a-table",{staticStyle:{height:"100%"},attrs:{ellipsis:!0,size:"small",columns:t.columns,"data-source":t.approvals,pagination:t.pagination,loading:t.loading,rowKey:"id"},on:{change:t.changePagination},scopedSlots:t._u([{key:"jobId",fn:function(e){return[a("a",{on:{click:function(a){return t.$router.push({name:"任务开发",params:{jobId:e}})}}},[t._v(t._s(e))])]}},{key:"description",fn:function(e,n){return a("div",{},[n.current?a("span",{staticStyle:{"background-color":"#87d068","font-size":"5px",color:"#fff",padding:"2px 4px"}},[t._v("最新发布")]):t._e(),t._v(" "+t._s(e)+" ")])}},{key:"jobTitle",fn:function(e){return a("div",{staticStyle:{position:"relative"}},[a("div",{staticStyle:{position:"relative"}},[t._v(t._s(e.jobName)+"("+t._s(e.id)+")")])])}},{key:"lastVersion",fn:function(e){return a("div",{},[e.lastVersion?[a("a-tag",[t._v(t._s(e.lastVersion.description))])]:e.current?[t._v(" - ")]:[t._v(" 无 ")]],2)}},{key:"stateInfo",fn:function(t){return a("div",{},[a("a-badge",{attrs:{color:t.color,text:t.text}})],1)}},{key:"action",fn:function(e){return a("div",{},[["padding","error"].includes(e.state)&&"auditor"===t.filter.mode?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.executeJobApproval(e.id,"agree")}}},[t._v("通过")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.executeJobApproval(e.id,"rejected")}}},[t._v("拒绝")])]:t._e(),"padding"===e.state&&"application"===t.filter.mode?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.executeJobApproval(e.id,"cancelled")}}},[t._v("取消")])]:t._e()],2)}}])})],1)},w=[];a("d81d"),a("d3b7");function D(t,e,a){return t=t||10,e=e||1,R(l["a"].post("/jobApproval/page",{pageSize:t,pageNum:e,filter:Object(h["a"])({},a)}),(function(t){return Object(h["a"])(Object(h["a"])({},t),{},{list:z(t.list)})}))}function T(t,e){return l["a"].post("/jobApproval/execute?id=".concat(t,"&state=").concat(e))}var $={padding:{color:"#ffb800",text:"待审批"},agree:{color:"#87d068",text:"成功"},cancelled:{color:"#909399",text:"已取消"},rejected:{color:"#f50",text:"已拒绝"},error:{color:"#f50",text:"失败"}};function z(t){if(Array.isArray(t)){var e=t;return e.map((function(t){return z(t)}))}return Object(h["a"])(Object(h["a"])({},t),{},{stateInfo:$[t.state]})}function R(t,e){return new Promise((function(a,n){return t.then((function(t){return a(e(t))})).catch((function(t){return n(t)}))}))}var C=[{value:"padding",label:"待审批"},{value:"agree",label:"成功"},{value:"cancelled",label:"已取消"},{value:"rejected",label:"已拒绝"},{value:"error",label:"失败"},{value:"",label:"所有状态"}],V=[{dataIndex:"id",title:"id"},{title:"actionId",key:"jobTitle",customRender:function(t,e){return"".concat(e.content.actionId)}},{title:"任务ID",dataIndex:"jobId",key:"jobId",scopedSlots:{customRender:"jobId"}},{title:"状态",dataIndex:"stateInfo",scopedSlots:{customRender:"stateInfo"}},{dataIndex:"username",title:"申请人"},{dataIndex:"auditorName",title:"审核人"},{title:"创建时间",dataIndex:"gmtCreate",customRender:function(t){return Object(b["a"])(t)}},{title:"操作时间",dataIndex:"gmtModified",customRender:function(t){return 0===t?"-":Object(b["a"])(t)}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],M={data:function(){return{stateOptions:C,columns:V,approvals:[],loading:!1,pagination:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:15},filter:{mode:"auditor",state:"padding",jobId:""}}},components:{},created:function(){this.init()},methods:{executeJobApproval:function(t,e){var a=this;T(t,e).then((function(){a.$message.success("成功!"),a.init()}))},init:function(){var t=this;this.loading=!0,D(this.pagination.pageSize,this.pagination.current,Object(h["a"])(Object(h["a"])({},this.filter),{},{state:""===this.filter.state?null:this.filter.state})).then((function(e){t.pagination={current:e.pageNum,pageSize:e.pageSize,total:e.total},t.approvals=e.list,t.loading=!1}))},changePagination:function(t){this.pagination=Object(h["a"])({},t),this.init()}}},N=M,E=(a("5a8e"),Object(u["a"])(N,O,w,!1,null,"21cd2d9f",null)),U=E.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"publish-container"},[a("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center",overflow:"hidden"}},[a("a-button",{attrs:{size:"small",icon:"redo"},on:{click:t.init}}),a("a-select",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{size:"small",options:t.stateOptions},on:{change:t.init},model:{value:t.filter.state,callback:function(e){t.$set(t.filter,"state",e)},expression:"filter.state"}}),a("a-input",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{size:"small",placeholder:"任务ID"},on:{pressEnter:t.init},model:{value:t.filter.jobId,callback:function(e){t.$set(t.filter,"jobId",e)},expression:"filter.jobId"}}),a("a-input",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{size:"small",placeholder:"名称"},on:{pressEnter:t.init},model:{value:t.filter.name,callback:function(e){t.$set(t.filter,"name",e)},expression:"filter.name"}}),a("a-input",{staticStyle:{width:"150px","margin-right":"10px"},attrs:{size:"small",placeholder:"创建用户"},on:{pressEnter:t.init},model:{value:t.filter.createUser,callback:function(e){t.$set(t.filter,"createUser",e)},expression:"filter.createUser"}}),a("a-range-picker",{staticStyle:{"margin-right":"10px"},attrs:{"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",placeholder:["创建日期开始","创建日期结束"],size:"small"},on:{ok:t.init},model:{value:t.filter.moment,callback:function(e){t.$set(t.filter,"moment",e)},expression:"filter.moment"}}),a("a-button",{attrs:{size:"small"},on:{click:function(e){t.addDialogVisible=!0}}},[t._v(" 新增 ")])],1),a("a-table",{staticStyle:{height:"100%",overflow:"auto"},attrs:{ellipsis:!0,size:"small",columns:t.columns,"data-source":t.dataSource,pagination:t.pagination,loading:t.loading,rowKey:"id"},on:{change:t.changePagination},scopedSlots:t._u([{key:"jobId",fn:function(e){return[a("a",{on:{click:function(a){return t.$router.push({name:"任务开发",params:{jobId:e}})}}},[t._v(t._s(e))])]}},{key:"state",fn:function(e){return a("div",{},[a("a-badge",{attrs:{color:t.stateMap[e.isEnd?1:0].color,text:t.stateMap[e.isEnd?1:0].text}})],1)}},{key:"process",fn:function(t){return a("div",{},[a("a-progress",{staticStyle:{width:"200px"},attrs:{format:function(e){return(t.extra.action_process_num||0)+"/"+(t.extra.action_all_num||0)},percent:t.extra.action_process_num/t.extra.action_all_num*100}})],1)}},{key:"action",fn:function(e){return a("div",{},[[e.isEnd?a("a",{on:{click:function(a){return t.changeRerunStatus(e)}}},[t._v("开启")]):a("a",{on:{click:function(a){return t.changeRerunStatus(e)}}},[t._v("关闭")])],e.extra.action_failed_num>0?[a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return t.openFailedRecordDialog(e.id)}}},[t._v("失败记录")])]:t._e()],2)}}])}),a("a-modal",{attrs:{title:"新建重跑"},on:{ok:t.submit,cancel:function(){t.addDialogVisible=!1,t.moment=[]}},model:{value:t.addDialogVisible,callback:function(e){t.addDialogVisible=e},expression:"addDialogVisible"}},[a("a-form",{attrs:{model:t.form,"label-col":{span:4},"wrapper-col":{span:14}}},[a("a-form-item",{attrs:{label:"任务ID"}},[a("a-input",{model:{value:t.form.jobId,callback:function(e){t.$set(t.form,"jobId",e)},expression:"form.jobId"}})],1),a("a-form-item",{attrs:{label:"名称"}},[a("a-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("a-form-item",{attrs:{label:"并行度"}},[a("a-select",{model:{value:t.form.threads,callback:function(e){t.$set(t.form,"threads",e)},expression:"form.threads"}},[a("a-select-option",{attrs:{value:1}},[t._v("1")]),a("a-select-option",{attrs:{value:2}},[t._v("2")]),a("a-select-option",{attrs:{value:4}},[t._v("4")]),a("a-select-option",{attrs:{value:8}},[t._v("8")])],1)],1),a("a-form-item",{attrs:{label:"重试次数"}},[a("a-select",{model:{value:t.form.retryCount,callback:function(e){t.$set(t.form,"retryCount",e)},expression:"form.retryCount"}},[a("a-select-option",{attrs:{value:0}},[t._v("0")]),a("a-select-option",{attrs:{value:1}},[t._v("1")]),a("a-select-option",{attrs:{value:2}},[t._v("2")]),a("a-select-option",{attrs:{value:4}},[t._v("4")]),a("a-select-option",{attrs:{value:8}},[t._v("8")])],1)],1),a("a-form-item",{attrs:{label:"时间范围"}},[a("a-range-picker",{attrs:{"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",placeholder:["Start Time","End Time"]},on:{onChange:t.chooseTime,ok:t.onOk},model:{value:t.moment,callback:function(e){t.moment=e},expression:"moment"}})],1)],1)],1),a("a-modal",{attrs:{width:1e3,okText:"重跑所有",title:"失败记录"},on:{ok:t.rerunAll,cancel:function(){t.filedRecordDialogVisible=!1}},model:{value:t.filedRecordDialogVisible,callback:function(e){t.filedRecordDialogVisible=e},expression:"filedRecordDialogVisible"}},[a("a-table",{staticStyle:{height:"100%",overflow:"auto"},attrs:{ellipsis:!0,size:"small",columns:t.columns2,"data-source":t.dataSource2,pagination:t.pagination2,loading:t.loading2,rowKey:"id"},on:{change:t.changePagination2}})],1)],1)},Y=[],H=a("bfb4"),K=[{color:"#87d068",text:"开启"},{color:"#f50",text:"关闭"}],P=[{value:-1,label:"所有状态"},{value:0,label:"开启"},{value:1,label:"结束"}],L=[{dataIndex:"id",title:"序号"},{title:"重跑名称",dataIndex:"name"},{title:"任务ID",dataIndex:"jobId",scopedSlots:{customRender:"jobId"}},{title:"起始时间",dataIndex:"startTime"},{title:"状态",key:"state",scopedSlots:{customRender:"state"}},{title:"结束时间",dataIndex:"endTime"},{title:"创建时间",dataIndex:"gmtCreate"},{title:"创建人",dataIndex:"ssoName"},{title:"并行度",key:"thread",customRender:function(t,e){return e.extra.rerun_thread}},{title:"进度",key:"process",scopedSlots:{customRender:"process"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],J=[{dataIndex:"actionId",title:"版本号"},{title:"任务名称",dataIndex:"name"},{title:"起始时间",dataIndex:"startTime"},{title:"状态",dataIndex:"status"},{title:"结束时间",dataIndex:"endTime"}],F={data:function(){return{stateMap:K,stateOptions:P,columns:L,dataSource:[],loading:!1,pagination:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:10},filter:{state:-1,jobId:"",name:"",createUser:"",moment:[],createTimeFrom:"",createTimeTo:""},addDialogVisible:!1,filedRecordDialogVisible:!1,form:{jobId:"",name:"",startTime_0:"",endTime_0:"",threads:1,retryCount:0},moment:[],pagination2:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:10},dataSource2:[],columns2:J,loading2:!1,rerunId:null}},components:{},created:function(){this.init()},methods:{rerunAll:function(){var t=this;Object(H["n"])(this.rerunId).then((function(){t.$message.success("提交成功"),t.filedRecordDialogVisible=!1,t.init()}))},submit:function(){var t=this,e=this.form,a=this.moment;if(a.length<1)this.$message.error("请选择日期");else{e.startTime_0=a[0].format("YYYY-MM-DD HH:mm:ss"),e.endTime_0=a[1].format("YYYY-MM-DD HH:mm:ss");var n=JSON.stringify(e),i=e.jobId;Object(H["a"])(i,n).then((function(){t.$message.success("添加成功!"),t.addDialogVisible=!1,t.init()}))}},onOk:function(t){console.log(t)},chooseTime:function(t,e){console.log(t,e)},openFailedRecordDialog:function(t){this.filedRecordDialogVisible=!0,this.rerunId=t,this.fetchFailedRecordTableData()},fetchFailedRecordTableData:function(){var t=this;this.loading2=!0;var e=this.pagination2;Object(H["e"])(e.pageSize,e.current,this.rerunId).then((function(e){t.dataSource2=e.list,t.pagination2=Object(h["a"])(Object(h["a"])({},t.pagination2),{},{total:e.total}),t.loading2=!1}))},changeRerunStatus:function(t){var e=this;Object(H["b"])(t.id,t.isEnd?0:1).then((function(){e.$message.success((t.isEnd?"开启":"关闭")+"成功"),e.init()}))},init:function(){var t=this;this.loading=!0;var e=this.filter.moment;e.length>0?(this.filter.createTimeFrom=1e3*e[0].unix(),this.filter.createTimeTo=1e3*e[1].unix()):(this.filter.createTimeFrom="",this.filter.createTimeTo=""),Object(H["i"])(this.pagination.pageSize,this.pagination.current,this.filter).then((function(e){t.pagination=Object(h["a"])(Object(h["a"])({},t.pagination),{},{total:e.total}),t.dataSource=e.list,t.loading=!1}))},changePagination:function(t){this.pagination=Object(h["a"])({},t),this.init()},changePagination2:function(t){this.pagination2=Object(h["a"])({},t),this.fetchFailedRecordTableData()}}},q=F,B=(a("83da"),Object(u["a"])(q,A,Y,!1,null,"04118b0f",null)),G=B.exports,Q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"publish-container"},[a("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center",overflow:"hidden"}},[a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{options:t.stateOptions,size:"small"},on:{change:t.init},model:{value:t.filter.status,callback:function(e){t.$set(t.filter,"status",e)},expression:"filter.status"}}),a("a-input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"名称",size:"small"},model:{value:t.filter.name,callback:function(e){t.$set(t.filter,"name",e)},expression:"filter.name"}}),a("a-input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"所有者",size:"small"},model:{value:t.filter.owner,callback:function(e){t.$set(t.filter,"owner",e)},expression:"filter.owner"}}),a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{options:t.users,placeholder:"任务关注人",size:"small"},on:{change:t.init},model:{value:t.filter.ssoId,callback:function(e){t.$set(t.filter,"ssoId",e)},expression:"filter.ssoId"}}),a("a-date-picker",{attrs:{size:"small"},on:{change:t.init},model:{value:t.dt,callback:function(e){t.dt=e},expression:"dt"}})],1),a("a-table",{staticStyle:{height:"100%",overflow:"auto"},attrs:{columns:t.columns,"data-source":t.filterDatasource,ellipsis:!0,loading:t.loading,pagination:Object.assign({},t.pagination,{total:t.filterDatasource.length}),scroll:{x:!0},rowKey:"id",size:"small"},on:{change:t.changePagination},scopedSlots:t._u([{key:"status",fn:function(e){return a("div",{staticStyle:{width:"60px"}},[a("a-badge",{attrs:{color:t.stateOptions.find((function(t){return t.value===e})).color,text:t.stateOptions.find((function(t){return t.value===e})).label}})],1)}},{key:"jobName",fn:function(e){return[a("a",{on:{click:function(a){return t.link2Develop(e.jobId)}}},[t._v(t._s(e.jobName))])]}}])})],1)},W=[],X=a("2909"),Z=(a("498a"),a("1276"),a("ac1f"),a("c1df")),tt=a.n(Z),et=[{value:"all",label:"全部"},{value:"failed",label:"失败",color:"#f50"},{value:"success",label:"成功",color:"#0abf5b"},{value:"running",label:"运行中",color:"#ffb800"},{value:"wait",label:"等待",color:"#909399"}],at=[{title:"任务ID",dataIndex:"jobId",fixed:!0},{title:"任务名称",key:"jobName",fixed:!0,scopedSlots:{customRender:"jobName"}},{dataIndex:"groupName",title:"任务组"},{title:"任务描述",dataIndex:"description"},{title:"所有者",dataIndex:"owner"},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"起始时间",dataIndex:"startTime"},{title:"结束时间",dataIndex:"endTime"},{title:"次数",dataIndex:"times"},{title:"机器",dataIndex:"executeHost"},{title:"操作人",dataIndex:"operator"}],nt={data:function(){return{stateOptions:et,columns:at,dataSource:[],loading:!1,pagination:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:15},filter:{status:"all",name:"",owner:"",ssoId:null},dt:null,defaultDt:new Date,users:[]}},computed:{filterDatasource:function(){var t=this,e=this.filter.name.trim(),a=e.split(" ").filter((function(t){return""!==t.trim}));return this.dataSource.filter((function(t){return""===e||a.filter((function(e){return t.jobName.includes(e)||t.jobId.includes(e)})).length>0})).filter((function(e){var a=t.filter.owner.trim();return""===a||e.owner.includes(a)}))}},components:{},created:function(){var t=this;Object(H["d"])().then((function(e){t.users=[{value:0,label:"所有人"}].concat(Object(X["a"])(e.map((function(t){return{value:t.id,label:t.name}})))),t.filter.ssoId=t.$store.getters["develop/user"]})),this.dt=this.moment(this.getCurrentData(),"YYYY-MM-DD"),this.init()},methods:{link2Develop:function(t){this.$router.push({name:"任务开发",params:{jobId:t}})},moment:tt.a,getCurrentData:function(){return(new Date).toLocaleDateString()},init:function(){var t=this;this.loading=!0,Object(H["g"])(Object(h["a"])(Object(h["a"])({},this.filter),{},{dt:this.dt.format("YYYY-MM-DD")})).then((function(e){t.pagination=Object(h["a"])(Object(h["a"])({},t.pagination),{},{total:e.total}),t.dataSource=e.list,t.loading=!1}))},changePagination:function(t){this.pagination=Object(h["a"])({},t)}}},it=nt,ot=(a("6d10"),a("6a01"),Object(u["a"])(it,Q,W,!1,null,"83b23574",null)),rt=ot.exports,lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"tabs-container"},t._l(t.tabs,(function(e){return a("div",{key:e.name,on:{click:function(a){return t.change(e)}}},[a("div",{class:["tab",e.name===t.tabActive?"active":"",e.children&&0!==e.children.length?"":"child",e.disabled?"disabled":""],style:{"padding-left":15*t.level+15+"px"}},[a("my-icon",{staticClass:"icon",staticStyle:{"margin-right":"6px"},attrs:{type:"hera_icon_"+(e.icon||e.name)}}),a("span",[t._v(t._s(e.label))])],1),e.children&&e.children.length>0?[a("h-menu",{attrs:{tabs:e.children,level:t.level+1},on:{update:t.change},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})]:t._e()],2)})),0)])},st=[],ct=(a("a9e3"),{props:{tabs:Array,level:{default:0,type:Number,require:!1},value:[Boolean,Number,String]},name:"HMenu",model:{prop:"value",event:"change"},computed:{tabActive:function(){return this.value}},methods:{change:function(t){var e;t.disabled||!(null!==(e=t.children)&&void 0!==e&&e.length)>0&&(this.level>0?this.$emit("update",t):this.$emit("change",t.name))}}}),ut=ct,dt=(a("fbec"),Object(u["a"])(ut,lt,st,!1,null,"d0fbc980",null)),ft=dt.exports,pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{padding:"20px"}},[a("h2",[t._v("一键移交任务")]),a("div",{staticStyle:{"margin-bottom":"10px"}},[t._v(" 前关注人 "),a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.users,"show-search":"","filter-option":t.filterOption},model:{value:t.fromUserId,callback:function(e){t.fromUserId=e},expression:"fromUserId"}})],1),a("div",{staticStyle:{"margin-bottom":"10px"}},[t._v(" 后关注人 "),a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.users,"show-search":"","filter-option":t.filterOption},model:{value:t.toUserId,callback:function(e){t.toUserId=e},expression:"toUserId"}})],1),a("a-button",{attrs:{size:"small",type:"primary"},on:{click:t.submit}},[t._v("确认修改")]),a("div",{staticStyle:{"margin-top":"10px"}},t._l(t.overRecords,(function(e,n){return a("div",{key:n,staticStyle:{"margin-top":"10px"}},[t._v(" "+t._s(t.getUsername(e.fromUserId))+" 的 "+t._s(e.tasks)+" 已移交给 "+t._s(t.getUsername(e.toUserId))+" ")])})),0)],1)},mt=[],ht=(a("7db0"),"over_tasks_records"),gt={data:function(){return{fromUserId:null,toUserId:null,users:[],overRecords:[]}},created:function(){var t=this;this.overRecords=JSON.parse(localStorage.getItem(ht)||"[]"),Object(H["d"])().then((function(e){t.users=e.map((function(t){return{value:t.id,label:t.name}}))}))},methods:{getUsername:function(t){var e;return(null===(e=this.users.find((function(e){return e.value===t})))||void 0===e?void 0:e.label)||t},addRecord:function(t,e,a){var n={fromUserId:t,toUserId:e,tasks:a},i=this.overRecords;i.push(n),localStorage.setItem(ht,JSON.stringify(i))},submit:function(){var t=this;Object(H["k"])({fromUserId:this.fromUserId,toUserId:this.toUserId}).then((function(e){t.addRecord(t.fromUserId,t.toUserId,e),t.$message.success("移交成功")}))},filterOption:function(t,e){return e.componentOptions.children[0].text.toLowerCase().indexOf(t.toLowerCase())>=0}}},bt=gt,vt=Object(u["a"])(bt,pt,mt,!1,null,null,null),xt=vt.exports,yt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"log-container"},[a("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center"}},[a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.recordOptions},on:{change:t.reInit},model:{value:t.filter.recordType,callback:function(e){t.$set(t.filter,"recordType",e)},expression:"filter.recordType"}}),a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.logTypeOptions},on:{change:t.reInit},model:{value:t.filter.logType,callback:function(e){t.$set(t.filter,"logType",e)},expression:"filter.logType"}}),a("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:t.userOptions},on:{change:t.reInit},model:{value:t.filter.ssoName,callback:function(e){t.$set(t.filter,"ssoName",e)},expression:"filter.ssoName"}}),"job"===t.filter.logType?a("a-input",{staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"任务ID"},on:{pressEnter:t.reInit},model:{value:t.filter.jobId,callback:function(e){t.$set(t.filter,"jobId",e)},expression:"filter.jobId"}}):t._e()],1),a("a-table",{staticStyle:{height:"100%"},attrs:{ellipsis:!0,size:"small",columns:t.columns,"data-source":t.dataSource,pagination:t.pagination,loading:t.loading,rowKey:"id"},on:{change:t.changePagination},scopedSlots:t._u([{key:"logId",fn:function(e,n){return["job"===n.logType?a("a",{on:{click:function(a){return t.$router.push({name:"任务开发",params:{jobId:e}})}}},[t._v(t._s(e))]):a("div",[t._v(t._s(e))])]}},{key:"action",fn:function(e){return a("div",{},[a("a",{on:{click:function(a){return t.showLog(e)}}},[t._v("查看")])])}}])}),a("a-modal",{attrs:{title:"对比",footer:null,width:"80%"},on:{cancel:function(){return t.visible=!1}},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("MonacoEditor",{staticStyle:{height:"calc(50vh - 20px)"},attrs:{original:t.compareContent.oldVal,theme:t.$store.state.setting.theme.mode,language:t.compareContent.lang,"diff-editor":!0,options:{fontSize:13,automaticLayout:!0,readOnly:!0}},model:{value:t.compareContent.newVal,callback:function(e){t.$set(t.compareContent,"newVal",e)},expression:"compareContent.newVal"}})],1)],1)},It=[],_t=a("b61c"),kt=a.n(_t),jt=a("1215"),St=[{dataIndex:"logId",title:"操作ID",scopedSlots:{customRender:"logId"}},{dataIndex:"type",title:"类型"},{dataIndex:"logType",title:"日志类型"},{dataIndex:"sso",title:"操作人"},{dataIndex:"gname",title:"所在组"},{dataIndex:"createTime",title:"操作时间"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],Ot={data:function(){return{columns:St,dataSource:[],loading:!1,pagination:{showTotal:function(t){return"共".concat(t,"条")},total:0,current:1,pageSize:15},filter:{logType:"null",recordType:"null",ssoName:"null"},userOptions:[],logTypeOptions:[],recordOptions:[],compareContent:{},visible:!1}},components:{MonacoEditor:kt.a},created:function(){var t=this,e=function(t,e,a){return[{label:"所有"+a,value:e}].concat(Object(X["a"])(t))};Object(H["d"])().then((function(a){t.userOptions=e(a.map((function(t){return{value:t.name,label:t.name}})),"null","用户")})),Object(H["j"])().then((function(a){t.logTypeOptions=e(a.logType,"null","日志类型"),t.recordOptions=e(a.recordType,"null","类型")})),this.init()},methods:{showLog:function(t){var e=this;Object(jt["r"])(Object(h["a"])({id:t.logId},t)).then((function(a){var n,i={spark:"sql",sive:"sql",shell:"shell",python:"python"},o=i[null===(n=a.runType)||void 0===n?void 0:n.toLowerCase()],r={old:t.content,newVal:a.content,lang:o};e.compareContent=r,e.visible=!0}))},init:function(){var t=this;this.loading=!0,Object(H["h"])(Object(h["a"])(Object(h["a"])({},this.filter),this.pagination)).then((function(e){t.pagination={current:e.pageNum,pageSize:e.pageSize,total:e.total},t.dataSource=e.list,t.loading=!1}))},reInit:function(){this.pagination.current=1,this.init()},changePagination:function(t){this.pagination=Object(h["a"])({},t),this.init()}}},wt=Ot,Dt=(a("568d"),Object(u["a"])(wt,yt,It,!1,null,"b8322c44",null)),Tt=Dt.exports,$t=[{name:"userManager",label:"用户管理",icon:"user",children:[{name:"user",label:"用户",icon:"my"},{name:"userGroup",label:"用户组",icon:"user"}]},{name:"clusterManager",label:"机器管理",icon:"cluster",children:[{name:"machine",label:"机器",icon:"cloud-server"},{name:"emr",label:"EMR",icon:"server"}]},{name:"job",label:"任务管理",children:[{name:"detail",label:"执行情况",icon:"runlog"},{name:"publish",label:"发布审批",icon:"publish"},{name:"recovery_approval",label:"超级恢复",icon:"recovery"},{name:"rerun",label:"任务重跑",icon:"rerun"}]},{name:"log",label:"日志记录",icon:"oplog"},{name:"secretKey",label:"旧版链接",icon:"link"}];function zt(t,e){t.forEach((function(t){t.children?zt(t.children,e):e.includes(t.name)||(t.disabled=!0)}))}zt($t,["publish","secretKey","recovery_approval","rerun","detail","user","log"]);var Rt={data:function(){return{tabs:$t,tabActive:"detail"}},components:{SecretKey:f,Recovery:U,Publish:S,HMenu:ft,Rerun:G,Detail:rt,User:xt,Log:Tt},created:function(){var t=JSON.parse(localStorage.getItem("admin_active")||JSON.stringify("detail"));this.tabActive=t},computed:{theme:function(){return this.$store.state.setting.theme.mode}},methods:{changeMenu:function(t){localStorage.setItem("admin_active",JSON.stringify(t))}}},Ct=Rt,Vt=(a("ba26"),Object(u["a"])(Ct,n,i,!1,null,"598a6b8d",null));e["default"]=Vt.exports},4497:function(t,e,a){},"463a":function(t,e,a){},"568d":function(t,e,a){"use strict";a("764b")},"5a8e":function(t,e,a){"use strict";a("17bc")},"6a01":function(t,e,a){"use strict";a("db0f")},"6d10":function(t,e,a){"use strict";a("4497")},"764b":function(t,e,a){},"83da":function(t,e,a){"use strict";a("dff5")},ba26:function(t,e,a){"use strict";a("463a")},bb29:function(t,e,a){"use strict";a("12c7")},c910:function(t,e,a){},db0f:function(t,e,a){},dff5:function(t,e,a){},fbec:function(t,e,a){"use strict";a("c910")}}]);