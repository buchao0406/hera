(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2036a2fa"],{"00ef":function(e,t,n){},"0305":function(e,t,n){"use strict";n("00ef")},2397:function(e,t,n){"use strict";n("fe3b")},4208:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("h-menu",{staticClass:"tabs",attrs:{tabs:e.tabs},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}}),n("div",{staticClass:"main-content"},["publish"===e.tabActive?n("publish"):"secretKey"===e.tabActive?n("secret-key"):[e._v(" 待开发 ")]],2)],1)},i=[],c=(n("159b"),n("caad"),n("2532"),n("b0c0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{padding:"20px"}},[n("h2",[e._v(" 旧版调度中心地址 "),n("h5",{staticStyle:{"margin-top":"5px"}},[e._v(e._s(e.countDownLabel)+"后失效")])]),""!==e.key?[n("a",{staticStyle:{"font-size":"25px"},attrs:{href:e.link,target:"_blank"}},[e._v(e._s(e.link))]),n("div",{staticStyle:{"margin-top":"20px"}},[n("a-button",{attrs:{type:"primary",size:"small"},on:{click:e.refreshKey}},[e._v("立即刷新")]),n("a-button",{staticStyle:{margin:"0 20px"},attrs:{size:"small"},on:{click:function(t){return e.copy(e.link)}}},[e._v("复制到剪贴板")]),n("a-input-number",{attrs:{size:"small",min:1,max:60},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),n("a-button",{staticStyle:{"margin-left":"-1px"},attrs:{size:"small"},on:{click:function(t){return e.resetCache()}}},[e._v("设置")])],1)]:n("h5",{staticStyle:{"margin-top":"5px"}},[e._v("没有权限")])],2)}),s=[],o=(n("99af"),n("b775")),l={data:function(){return{key:"",duration:0,createTime:0,countDownInterval:null,countDownLabel:"",value:0}},computed:{link:function(){var e=window.location.host;return"".concat(e,"/scheduleCenter?key=").concat(this.key)}},created:function(){this.countDown(),this.refreshKey()},destroyed:function(){this.clearCountDown()},methods:{countDown:function(){var e=this;this.countDownInterval=setInterval((function(){console.log(e.createTime);var t=e.createTime/1e3+60*e.duration,n=parseInt(Date.parse(new Date)/1e3),a=parseInt(t-n),i=Math.floor(a/60%60),c=Math.floor(a%60);e.countDownLabel="".concat(i,"分").concat(c,"秒"),a<=0&&(e.countDownLabel="",e.refreshKey())}),1e3)},clearCountDown:function(){clearInterval(this.countDownInterval),this.countDownLabel="",this.countDownInterval=null},refreshKey:function(){var e=this;o["a"].get("/key").then((function(t){e.key=t.key,e.duration=t.duration,e.value=e.duration,e.createTime=t.createTime}))},resetCache:function(){var e=this;o["a"].post("/resetCache?duration=".concat(this.value)).then((function(){e.$message.success("设置成功! "),e.refreshKey()}))},copy:function(e){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();var n=document.execCommand("copy");n&&this.$message.success("复制成功！"),document.body.removeChild(t)}}},r=l,u=n("2877"),d=Object(u["a"])(r,c,s,!1,null,null,null),f=d.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"publish-container"},[n("div",{staticStyle:{"margin-bottom":"10px",display:"flex","align-items":"center"}},[n("a-select",{staticStyle:{width:"120px","margin-right":"15px"},attrs:{size:"small",options:e.stateOptions},on:{change:e.init},model:{value:e.filter.state,callback:function(t){e.$set(e.filter,"state",t)},expression:"filter.state"}}),n("a-input",{staticStyle:{width:"120px","margin-right":"20px"},attrs:{size:"small",placeholder:"任务ID"},on:{pressEnter:e.init},model:{value:e.filter.jobId,callback:function(t){e.$set(e.filter,"jobId",t)},expression:"filter.jobId"}}),n("a-radio-group",{on:{change:e.init},model:{value:e.filter.mode,callback:function(t){e.$set(e.filter,"mode",t)},expression:"filter.mode"}},[n("a-radio",{attrs:{value:"auditor"}},[e._v("审核")]),n("a-radio",{attrs:{value:"application"}},[e._v("申请")])],1)],1),n("a-table",{staticStyle:{height:"100%"},attrs:{ellipsis:!0,size:"small",columns:e.columns,"data-source":e.publishes,pagination:e.pagination,loading:e.loading,rowKey:"id"},on:{change:e.changePagination},scopedSlots:e._u([{key:"description",fn:function(t,a){return n("div",{},[a.current?n("span",{staticStyle:{"background-color":"#87d068","font-size":"5px",color:"#fff",padding:"2px 4px"}},[e._v("最新发布")]):e._e(),e._v(" "+e._s(t)+" ")])}},{key:"jobTitle",fn:function(t){return n("div",{staticStyle:{position:"relative"}},[n("div",{staticStyle:{position:"relative"}},[e._v(e._s(t.jobName)+"("+e._s(t.id)+")")])])}},{key:"lastVersion",fn:function(t){return n("div",{},[t.lastVersion?[n("a-tag",[e._v(e._s(t.lastVersion.description))])]:t.current?[e._v(" - ")]:[e._v(" 无 ")]],2)}},{key:"stateInfo",fn:function(e){return n("div",{},[n("a-badge",{attrs:{color:e.color,text:e.text}})],1)}},{key:"action",fn:function(t){return n("div",{},[n("a",{attrs:{disabled:!t.lastVersion},on:{click:function(n){return e.compare(t)}}},[e._v("代码对比")]),"padding"===t.state&&"auditor"===e.filter.mode?[n("a-divider",{attrs:{type:"vertical"}}),n("a",{on:{click:function(n){return e.pass(t)}}},[e._v("通过")]),n("a-divider",{attrs:{type:"vertical"}}),n("a",{on:{click:function(n){return e.reject(t)}}},[e._v("拒绝")])]:"error"===t.state?[n("a-divider",{attrs:{type:"vertical"}}),n("a",{on:{click:function(n){return e.retry(t)}}},[e._v("重试")])]:e._e(),"padding"===t.state&&"application"===e.filter.mode?[n("a-divider",{attrs:{type:"vertical"}}),n("a",{on:{click:function(n){return e.cancel(t)}}},[e._v("取消")])]:e._e(),"success"===t.state&&t.current&&0!==t.last?[n("a-divider",{attrs:{type:"vertical"}}),n("a",{on:{click:function(n){return e.rollback(t)}}},[e._v("回滚")])]:e._e()],2)}}])}),n("code-compare",{ref:"codeCompareRef"})],1)},m=[],h=n("5530"),v=(n("a4d3"),n("e01a"),n("4de4"),n("10f8")),b=n("c466"),g=n("8656"),y=[{value:"padding",label:"待审批"},{value:"success",label:"成功"},{value:"cancelled",label:"已取消"},{value:"rejected",label:"已拒绝"},{value:"error",label:"失败"},{value:"rolledBack",label:"已回滚"},{value:"",label:"所有状态"}],_=[{dataIndex:"description",title:"发布描述",scopedSlots:{customRender:"description"}},{title:"任务名",key:"jobTitle",customRender:function(e,t){return"".concat(t.jobName,"(").concat(t.jobId,")")}},{key:"lastVersion",title:"线上",scopedSlots:{customRender:"lastVersion"}},{title:"状态",dataIndex:"stateInfo",scopedSlots:{customRender:"stateInfo"}},{dataIndex:"username",title:"申请人"},{dataIndex:"auditorName",title:"审核人"},{title:"创建时间",dataIndex:"gmtCreate",customRender:function(e){return Object(b["a"])(e)}},{title:"操作时间",dataIndex:"opTime",customRender:function(e){return 0===e?"-":Object(b["a"])(e)}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}];function k(e,t){return{script:e.script,selfConfigs:e.selfConfigs,description:t||"["+e.description+"] "+Object(b["a"])(e.gmtCreate)}}var x={data:function(){return{stateOptions:y,columns:_,publishes:[],loading:!1,pagination:{showTotal:function(e){return"共".concat(e,"条")},total:0,current:1,pageSize:15},filter:{mode:"auditor",state:"padding",jobId:""}}},components:{CodeCompare:v["a"]},created:function(){this.init()},methods:{init:function(){var e=this;this.loading=!0,Object(g["e"])(this.pagination.pageSize,this.pagination.current,Object(h["a"])(Object(h["a"])({},this.filter),{},{state:""===this.filter.state?null:this.filter.state})).then((function(t){e.pagination={current:t.pageNum,pageSize:t.pageSize,total:t.total},e.publishes=t.list,e.loading=!1}))},compare:function(e){this.$refs.codeCompareRef.show(e.jobRunType,k(e.lastVersion),k(e))},pass:function(e){var t=this;Object(g["f"])(e.id).then((function(){t.$message.success("通过成功!"),t.init()}))},retry:function(e){var t=this;Object(g["h"])(e.is).then((function(){t.$message.success("重试成功!"),t.init()}))},cancel:function(e){var t=this;Object(g["a"])(e.id).then((function(){t.$message.success("取消成功!"),t.init()}))},reject:function(e){var t=this;Object(g["g"])(e.id).then((function(){t.$message.success("拒绝成功!"),t.init()}))},rollback:function(e){var t=this;Object(g["i"])(e.id).then((function(){t.$message.success("回滚成功!"),t.init()}))},changePagination:function(e){this.pagination=Object(h["a"])({},e),this.init()}}},j=x,w=(n("e077"),Object(u["a"])(j,p,m,!1,null,"7d3aef8c",null)),S=w.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"tabs-container"},e._l(e.tabs,(function(t){return n("div",{key:t.name,on:{click:function(n){return e.change(t)}}},[n("div",{class:["tab",t.name===e.tabActive?"active":"",t.children&&0!==t.children.length?"":"child",t.disabled?"disabled":""],style:{"padding-left":10*e.level+10+"px"}},[n("my-icon",{staticClass:"icon",staticStyle:{"margin-right":"6px"},attrs:{type:"hera_icon_"+(t.icon||t.name)}}),n("span",[e._v(e._s(t.label))])],1),t.children&&t.children.length>0?[n("h-menu",{attrs:{tabs:t.children,level:e.level+1},on:{update:e.change},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})]:e._e()],2)})),0)])},I=[],O=(n("a9e3"),{props:{tabs:Array,level:{default:0,type:Number,require:!1},value:[Boolean,Number,String]},name:"HMenu",model:{prop:"value",event:"change"},computed:{tabActive:function(){return this.value}},methods:{change:function(e){var t;e.disabled||!(null!==(t=e.children)&&void 0!==t&&t.length)>0&&(this.level>0?this.$emit("update",e):this.$emit("change",e.name))}}}),$=O,D=(n("0305"),Object(u["a"])($,C,I,!1,null,"2aa59301",null)),z=D.exports,R=[{name:"userManager",label:"用户管理",icon:"user",children:[{name:"user",label:"用户",icon:"my"},{name:"userGroup",label:"用户组",icon:"user"}]},{name:"clusterManager",label:"机器管理",icon:"cluster",children:[{name:"machine",label:"机器"},{name:"emr",label:"EMR"}]},{name:"job",label:"任务管理",children:[{name:"publish",label:"发布",icon:"publish"},{name:"search",label:"搜索"},{name:"monitor",label:"监控"},{name:"rerun",label:"重跑"}]},{name:"runlog",label:"系统日志"},{name:"secretKey",label:"旧版链接"}];function K(e,t){e.forEach((function(e){e.children?K(e.children,t):t.includes(e.name)||(e.disabled=!0)}))}K(R,["publish","secretKey"]);var T={data:function(){return{tabs:R,tabActive:"publish"}},components:{SecretKey:f,Publish:S,HMenu:z},computed:{theme:function(){return this.$store.state.setting.theme.mode}},methods:{}},A=T,E=(n("2397"),Object(u["a"])(A,a,i,!1,null,"3acfc659",null));t["default"]=E.exports},9703:function(e,t,n){},e077:function(e,t,n){"use strict";n("9703")},fe3b:function(e,t,n){}}]);